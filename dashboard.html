<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | SSPC</title>
    <script>
        (function () {
            try {
                const stored = localStorage.getItem('sspcTheme');
                if (stored === 'dark') {
                    document.documentElement.classList.add('theme-dark');
                }
            } catch (e) {
                // no-op
            }
        })();
    </script>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SSPC">
    <link rel="apple-touch-icon" href="assets/icons/icon-180.png">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <!-- QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <button class="btn btn-link text-dark me-3 d-lg-none" id="sidebarToggle">
                <i class="fas fa-bars fa-lg"></i>
            </button>
            
            <a class="navbar-brand" href="#" onclick="window.navigateToSection('dashboard'); return false;">
                <img src="logo.png" alt="Logo" width="40" height="40" class="d-inline-block align-text-top me-2">
                <span class="d-none d-lg-inline">Sree Srinivasa Pipe Company</span>
                <span class="d-inline d-lg-none">SSPC</span>
            </a>
            
            <div class="d-flex align-items-center ms-auto">
                <button class="btn btn-nav ms-2 me-3 theme-toggle" id="themeToggle" type="button" title="Toggle theme" aria-label="Toggle theme">
                    <span class="toggle-track" aria-hidden="true">
                        <span class="toggle-knob">
                            <span class="knob-icon sun"><i class="fas fa-sun"></i></span>
                            <span class="knob-icon moon"><i class="fas fa-moon"></i></span>
                        </span>
                    </span>
                </button>
                <!-- Notifications -->
                <div class="dropdown me-3">
                    <button class="btn btn-light position-relative rounded-circle p-2" type="button" id="notificationBtn" data-bs-toggle="dropdown">
                        <i class="fas fa-bell text-secondary"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light p-1 d-none" id="notificationBadge">0</span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end" id="notificationMenu">
                        <h6 class="dropdown-header">Notifications</h6>
                        <div class="dropdown-item text-center text-muted small">No new notifications</div>
                    </div>
                </div>
                
                <!-- Mobile Logout -->
                <button class="btn btn-link d-lg-none text-white p-2" id="mobileLogoutBtn">
                    <i class="fas fa-sign-out-alt fa-lg"></i>
                </button>
                <button class="btn btn-link d-lg-none text-white p-2" id="mobileLockBtn" title="Lock">
                    <i class="fas fa-lock fa-lg"></i>
                </button>

                <!-- User Menu -->
                <div class="dropdown d-none d-lg-block">
                    <button class="btn btn-light dropdown-toggle d-flex align-items-center rounded-pill px-3" type="button" data-bs-toggle="dropdown">
                        <div class="avatar-sm me-2">
                            <i class="fas fa-user"></i>
                        </div>
                        <span id="userName" class="d-none d-md-block fw-medium">Loading...</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                        <li><h6 class="dropdown-header" id="userEmail">Loading...</h6></li>
                        <li><a class="dropdown-item" href="#" onclick="window.navigateToSection('profile'); return false;"><i class="fas fa-user me-2"></i>Profile</a></li>
                        <li><a class="dropdown-item" href="#" onclick="window.navigateToSection('settings'); return false;"><i class="fas fa-cog me-2"></i>Settings</a></li>
                        <li><a class="dropdown-item" href="index.html"><i class="fas fa-home me-2"></i>Landing Page</a></li>
                        <li><a class="dropdown-item" href="#" id="lockBtn"><i class="fas fa-lock me-2"></i>Lock</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar">
        <div class="position-sticky">
            <!-- Mobile User Profile -->
            <div class="d-lg-none text-center py-4 mb-2" style="background: rgba(0,0,0,0.03);">
                <div class="avatar-circle-lg bg-primary text-white mx-auto mb-2 d-flex align-items-center justify-content-center shadow-sm" style="width: 60px; height: 60px; font-size: 1.5rem; border-radius: 50%;">
                    <i class="fas fa-user"></i>
                </div>
                <h6 class="mb-0 fw-bold text-dark" id="sidebarUserName">User</h6>
                <small class="text-muted d-block mb-3" id="sidebarUserEmail">email@example.com</small>
                <a href="#" onclick="window.navigateToSection('profile'); return false;" class="btn btn-sm btn-outline-primary rounded-pill px-4">
                    View Profile
                </a>
            </div>

                        <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="dashboard">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="supply">
                                <i class="fas fa-handshake me-2"></i>
                                Suppliers & Materials
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="projects">
                                <i class="fas fa-project-diagram me-2"></i>
                                Orders
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="production">
                                <i class="fas fa-industry me-2"></i>
                                Production
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="inventory">
                                <i class="fas fa-boxes me-2"></i>
                                Stock
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="customers">
                                <i class="fas fa-users me-2"></i>
                                Customers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="invoices">
                                <i class="fas fa-file-invoice-dollar me-2"></i>
                                Bills
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="gst">
                                <i class="fas fa-file-invoice me-2"></i>
                                GST Billing
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="payments">
                                <i class="fas fa-hand-holding-usd me-2"></i>
                                Payments
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="profit-loss">
                                <i class="fas fa-scale-balanced me-2"></i>
                                Profit
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="audit">
                                <i class="fas fa-file-circle-check me-2"></i>
                                Audit
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="vehicles">
                                <i class="fas fa-truck me-2"></i>
                                Vehicles
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="staff">
                                <i class="fas fa-id-card me-2"></i>
                                Staff
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="settings">
                                <i class="fas fa-cog me-2"></i>
                                Settings
                            </a>
                        </li>
                    </ul>
                    
                    <!-- Quick Stats -->
                    <div class="mt-5 p-3 bg-light rounded-3 mx-2 quick-stats-card">
                        <h6 class="border-bottom pb-2">Quick Stats</h6>
                        <div class="row text-center mt-3">
                            <div class="col-6 mb-3">
                                <div class="stat-value quick-stat-value" id="totalProjects">0</div>
                                <small class="text-muted">Orders</small>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stat-value quick-stat-value" id="totalCustomers">0</div>
                                <small class="text-muted">Customers</small>
                            </div>
                            <div class="col-6">
                                <div class="stat-value quick-stat-value text-success" id="monthlyRevenue">&#8377;0</div>
                                <small class="text-muted">Revenue</small>
                            </div>
                            <div class="col-6">
                                <div class="stat-value quick-stat-value text-warning" id="pendingInvoices">0</div>
                                <small class="text-muted">Pending</small>
                            </div>
                        </div>
                    </div>
        </div>
    </nav>

            <!-- Main Content -->
            <main>
                <!-- Alert Container -->
                <div id="alertMessage" class="alert d-none mt-3"></div>

                <!-- SECTION: DASHBOARD -->
                <div id="section-dashboard" class="main-section">
                
                <!-- Mobile Hero & Nav (Visible only on mobile/tablet) -->
                <div class="d-lg-none">
                    <div class="mobile-hero-container">
                        <i class="fas fa-pipe-circle-notch mobile-hero-bg-icon"></i>
                        <div class="d-flex justify-content-between align-items-center position-relative z-1">
                            <div>
                                <h2 class="fw-bold mb-1">Hello, <span id="mobileUserName">User</span></h2>
                                <p class="mb-0 opacity-75 small">Here's your business overview</p>
                            </div>
                            <div class="hero-logo-box">
                                <div class="hero-spinner-ring hero-ring-outer"></div>
                                <div class="hero-spinner-ring hero-ring-inner"></div>
                                <img src="logo.png" class="hero-center-icon" alt="Logo">
                            </div>
                        </div>
                    </div>

                    <!-- 4x2 Nav Grid -->
                    <div class="container-fluid px-0 mb-4" style="margin-top: -30px;">
                        <div class="row g-2 px-2">
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('supply'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-primary bg-opacity-10 text-primary"><i class="fas fa-handshake"></i></div>
                                    <span class="nav-label">Supply</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('inventory'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-primary bg-opacity-10 text-primary"><i class="fas fa-boxes"></i></div>
                                    <span class="nav-label">Stock</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('production'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-warning bg-opacity-10 text-warning"><i class="fas fa-industry"></i></div>
                                    <span class="nav-label">Production</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('customers'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-danger bg-opacity-10 text-danger"><i class="fas fa-users"></i></div>
                                    <span class="nav-label">Customers</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('invoices'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-success bg-opacity-10 text-success"><i class="fas fa-file-invoice-dollar"></i></div>
                                    <span class="nav-label">Bills</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('projects'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-info bg-opacity-10 text-info"><i class="fas fa-project-diagram"></i></div>
                                    <span class="nav-label">Orders</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('vehicles'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-dark bg-opacity-10 text-dark"><i class="fas fa-truck"></i></div>
                                    <span class="nav-label">Vehicles</span>
                                </a>
                            </div>
                            <div class="col-3">
                                <a href="#" onclick="window.navigateToSection('staff'); return false;" class="nav-icon-box">
                                    <div class="nav-icon-circle bg-secondary bg-opacity-10 text-secondary"><i class="fas fa-id-card"></i></div>
                                    <span class="nav-label">Staff</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Summary + Low Stock -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-xl col-lg-4 col-md-6 col-12">
                                <div class="card border-start-primary shadow-sm h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="text-xs fw-bold text-primary text-uppercase mb-1">Production</div>
                                                <div class="h5 mb-0 fw-bold text-gray-800" id="dashProductionSummary">0</div>
                                                <small class="text-muted" id="dashProductionSummarySub">This month</small>
                                            </div>
                                            <div class="text-primary"><i class="fas fa-industry fa-2x"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl col-lg-4 col-md-6 col-12">
                                <div class="card border-start-success shadow-sm h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="text-xs fw-bold text-success text-uppercase mb-1">Stock</div>
                                                <div class="h5 mb-0 fw-bold text-gray-800" id="dashStockSummary">0</div>
                                                <small class="text-muted" id="dashStockSummarySub">Total items</small>
                                            </div>
                                            <div class="text-success"><i class="fas fa-boxes fa-2x"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl col-lg-4 col-md-6 col-12">
                                <div class="card border-start-info shadow-sm h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="text-xs fw-bold text-info text-uppercase mb-1">Sales Today</div>
                                                <div class="h5 mb-0 fw-bold text-gray-800" id="dashSalesToday">&#8377;0</div>
                                                <small class="text-muted">Paid invoices</small>
                                            </div>
                                            <div class="text-info"><i class="fas fa-receipt fa-2x"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl col-lg-4 col-md-6 col-12">
                                <div class="card border-start-warning shadow-sm h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="text-xs fw-bold text-warning text-uppercase mb-1">Pending Payments</div>
                                                <div class="h5 mb-0 fw-bold text-gray-800" id="dashPendingPayments">&#8377;0</div>
                                                <small class="text-muted">Invoices due</small>
                                            </div>
                                            <div class="text-warning"><i class="fas fa-hourglass-half fa-2x"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl col-lg-4 col-md-6 col-12">
                                <div class="card border-start-danger shadow-sm h-100">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <div class="text-xs fw-bold text-danger text-uppercase mb-1">Low Stock Alerts</div>
                                                <div class="h5 mb-0 fw-bold text-gray-800" id="dashLowStockAlerts">0</div>
                                                <small class="text-muted">Needs reorder</small>
                                            </div>
                                            <div class="text-danger"><i class="fas fa-exclamation-triangle fa-2x"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="production-status-card mt-3">
                            <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                                <div>
                                    <div class="text-xs fw-bold text-primary text-uppercase">Production Status</div>
                                    <div class="text-muted small">Live status and available stock</div>
                                </div>
                                <a href="#" onclick="window.navigateToSection('production'); return false;" class="btn btn-sm btn-outline-primary">View Production</a>
                            </div>
                            <div class="status-grid mt-3">
                                <div class="status-item">
                                    <div class="status-label">Started</div>
                                    <div class="status-value" id="dashProdStarted">0</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">On Curing</div>
                                    <div class="status-value" id="dashProdCuring">0</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Ready</div>
                                    <div class="status-value" id="dashProdReady">0</div>
                                </div>
                                <div class="status-item status-highlight">
                                    <div class="status-label">Available Stock</div>
                                    <div class="status-value" id="dashProdAvailable">0</div>
                                </div>
                            </div>
                        </div>
                        <hr class="my-3">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <h6 class="m-0 fw-bold text-dark">Low Stock Alerts</h6>
                            <span class="badge bg-danger" id="dashLowStockCount">0</span>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm align-middle mb-0" id="lowStockTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>Item</th>
                                        <th class="text-end">Qty</th>
                                        <th class="text-end">Reorder</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="3" class="text-center text-muted py-2">No low stock items</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="card mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <div>
                            <h6 class="m-0 fw-bold text-dark">Item-wise Stock Summary</h6>
                            <small class="text-muted">Finished goods available by product</small>
                        </div>
                        <a href="#" onclick="window.navigateToSection('inventory'); return false;" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm align-middle mb-0" id="dashStockSummaryTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>Item</th>
                                        <th>Category</th>
                                        <th class="text-end">Available</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="3" class="text-center text-muted py-2">Loading stock summary...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Performance & Activity -->
                <div class="row">
                    <div class="col-xl-8 col-lg-7">
                        <div class="card elevated-card mb-4">
                            <div class="card-header d-flex align-items-center justify-content-between">
                                <div>
                                    <h6 class="m-0 fw-bold text-dark">Revenue Momentum</h6>
                                    <small class="text-muted">Invoices paid over the last 6 months</small>
                                </div>
                                <div class="header-actions">
                                    <button class="btn btn-sm btn-outline-dark">Export</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-area">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-4 col-lg-5">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="m-0 fw-bold text-dark">Operational Focus</h6>
                            </div>
                            <div class="card-body">
                                <div class="focus-list">
                                    <div class="focus-item">
                                        <span class="focus-dot dot-warning"></span>
                                        <div>
                                            <div class="focus-title">Replenish priority materials</div>
                                            <div class="focus-text">Check inventory thresholds and reorder today.</div>
                                        </div>
                                    </div>
                                    <div class="focus-item">
                                        <span class="focus-dot dot-info"></span>
                                        <div>
                                            <div class="focus-title">Follow up on pending invoices</div>
                                            <div class="focus-text">Send reminders for overdue balances.</div>
                                        </div>
                                    </div>
                                    <div class="focus-item">
                                        <span class="focus-dot dot-success"></span>
                                        <div>
                                            <div class="focus-title">Keep production cadence</div>
                                            <div class="focus-text">Update new runs and curing status.</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="quick-actions mt-3">
                                    <a href="#" onclick="window.navigateToSection('inventory'); return false;" class="action-pill">Inventory</a>
                                    <a href="#" onclick="window.navigateToSection('production'); return false;" class="action-pill">Production</a>
                                    <a href="#" onclick="window.navigateToSection('invoices'); return false;" class="action-pill">Invoices</a>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header d-flex align-items-center justify-content-between">
                                <h6 class="m-0 fw-bold text-dark">Recent Orders</h6>
                                <a href="#" onclick="window.navigateToSection('projects'); return false;" class="btn btn-sm btn-outline-primary">View All</a>
                            </div>
                            <div class="card-body">
                                <div class="list-group list-group-flush" id="recentProjects">
                                    <!-- Orders will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                </div>

                <!-- SECTION: INVENTORY -->
                <div id="section-inventory" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <div>
                            <h1 class="h2 mb-1">Finished Goods Stock</h1>
                            <div class="text-muted small">Stock is created only from production completion.</div>
                        </div>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportInventoryPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportInventoryCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">Total Items</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="inv_totalItems">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-boxes fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">Low Stock</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="inv_lowStockItems">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-success text-uppercase mb-1">Total Value</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="inv_inventoryValue">&#8377;0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-rupee-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-5">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control" id="searchInventory" placeholder="Search items...">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="filterInventoryCategory">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="filterInventoryStock">
                                <option value="all">All Stock</option>
                                <option value="low">Low Stock</option>
                                <option value="out">Out of Stock</option>
                                <option value="available">Available</option>
                            </select>
                        </div>
                        <div class="col-md-1 d-grid">
                            <button class="btn btn-outline-secondary" id="resetInventoryFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                        </div>
                    </div>

                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="inventoryTable">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Category</th>
                                            <th>Description</th>
                                            <th>HSN/SAC</th>
                                            <th>GST%</th>
                                            <th>Qty</th>
                                            <th>Reorder</th>
                                            <th>Unit</th>
                                            <th>Cost</th>
                                            <th>Price</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: SUPPLIERS & MATERIALS -->
                <div id="section-supply" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Suppliers & Materials</h1>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-primary" id="addSupplierBtn">
                                <i class="fas fa-plus me-1"></i> Add Supplier
                            </button>
                            <button class="btn btn-primary" id="addRawMaterialBtn">
                                <i class="fas fa-plus me-1"></i> Add Material
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportRawMaterialsPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportRawMaterialsCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-light border d-flex flex-wrap align-items-center gap-2 mb-4">
                        <span class="badge bg-primary">Step 1</span>
                        <span>Add or verify supplier details.</span>
                        <span class="badge bg-success">Step 2</span>
                        <span>Add material and assign supplier.</span>
                        <span class="text-muted small ms-auto">Duplicate names are blocked automatically.</span>
                    </div>

                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0">Suppliers</h5>
                                <small class="text-muted">Step 1: add or update supplier details.</small>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportSuppliersPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportSuppliersCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="searchSuppliers" placeholder="Search by name, contact, or phone...">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="filterSupplierType">
                                        <option value="all">All Types</option>
                                        <!-- Options populated by JS -->
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select" id="filterSupplierStatus">
                                        <option value="all">All Status</option>
                                        <option value="Active">Active</option>
                                        <option value="Inactive">Inactive</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row" id="suppliersContainer">
                                <!-- Supplier cards will be loaded here by JS -->
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
                        <div>
                            <h5 class="mb-0">Materials</h5>
                            <small class="text-muted">Step 2: add materials and assign a supplier.</small>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-4 mb-4">
                            <div class="card border-start-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">Total Materials</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="rm_totalItems">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-layer-group fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card border-start-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">Low Stock</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="rm_lowStock">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="card border-start-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-success text-uppercase mb-1">Stock Value</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="rm_totalValue">&#8377;0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-rupee-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-md-5">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="searchRawMaterials" placeholder="Search materials...">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="filterRawMaterialCategory">
                                        <option value="all">All Categories</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="filterRawMaterialSupplier">
                                        <option value="all">All Suppliers</option>
                                    </select>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover" id="rawMaterialTable">
                                    <thead>
                                        <tr>
                                            <th>Material Name</th>
                                            <th>Category</th>
                                            <th>Supplier</th>
                                            <th>Quantity</th>
                                            <th>Reorder Level</th>
                                            <th>Cost (&#8377;)</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: STAFF -->
                <div id="section-staff" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Staff & Attendance</h1>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-outline-dark me-2" id="attendanceSettingsBtn">
                                <i class="fas fa-cog me-1"></i> Settings
                            </button>
                            <button class="btn btn-outline-primary me-2" id="generateQrBtn">
                                <i class="fas fa-qrcode me-1"></i> Attendance QR
                            </button>
                            <button class="btn btn-primary" id="addStaffBtn">
                                <i class="fas fa-user-plus me-1"></i> Add Staff
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportStaffPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportStaffCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Staff Tabs -->
                    <ul class="nav nav-tabs mb-4" id="staffTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="staff-list-tab" data-bs-toggle="tab" data-bs-target="#staffListPane" type="button" role="tab">Staff List</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="attendance-log-tab" data-bs-toggle="tab" data-bs-target="#attendanceLogPane" type="button" role="tab">Attendance Log</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="payroll-tab" data-bs-toggle="tab" data-bs-target="#payrollPane" type="button" role="tab">Payroll Report</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="staffTabContent">
                        <!-- Staff List Pane -->
                        <div class="tab-pane fade show active" id="staffListPane" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-body">
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-5">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input type="text" class="form-control" id="searchStaff" placeholder="Search staff...">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <select class="form-select" id="filterStaffRole">
                                                <option value="all">All Roles</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-select" id="filterStaffStatus">
                                                <option value="all">All Status</option>
                                                <option value="Active">Active</option>
                                                <option value="Inactive">Inactive</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="staffTable">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Mobile</th>
                                                    <th>Role</th>
                                                    <th>Wage / Salary</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Attendance Log Pane -->
                        <div class="tab-pane fade" id="attendanceLogPane" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 fw-bold text-primary">Today's Attendance</h6>
                                    <div class="d-flex gap-2">
                                        <input type="date" class="form-control form-control-sm w-auto" id="attendanceDateFilter">
                                        <button class="btn btn-sm btn-primary" id="manualAttendanceBtn"><i class="fas fa-plus me-1"></i> Manual Entry</button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input type="text" class="form-control" id="searchAttendance" placeholder="Search attendance...">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <select class="form-select" id="filterAttendanceStatus">
                                                <option value="all">All Status</option>
                                                <option value="Present">Present</option>
                                                <option value="Late">Late</option>
                                                <option value="Absent">Absent</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="attendanceTable">
                                            <thead>
                                                <tr>
                                                    <th>Time</th>
                                                    <th>Staff Name</th>
                                                    <th>Role</th>
                                                    <th>Wage Earned</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payroll Pane -->
                        <div class="tab-pane fade" id="payrollPane" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 fw-bold text-primary">Monthly Payroll</h6>
                                    <div class="d-flex gap-2">
                                        <input type="month" class="form-control form-control-sm w-auto" id="payrollMonthFilter">
                                        <button class="btn btn-sm btn-outline-success" id="exportPayrollCsvBtn" title="Export CSV"><i class="fas fa-file-csv"></i></button>
                                        <button class="btn btn-sm btn-outline-danger" id="exportPayrollPdfBtn" title="Export PDF"><i class="fas fa-file-pdf"></i></button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="window.print()" title="Print"><i class="fas fa-print"></i></button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input type="text" class="form-control" id="searchPayroll" placeholder="Search payroll...">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <select class="form-select" id="filterPayrollRole">
                                                <option value="all">All Roles</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="payrollTable">
                                            <thead>
                                                <tr>
                                                    <th>Staff Name</th>
                                                    <th>Role</th>
                                                    <th>Days Present</th>
                                                    <th>Total Wages</th>
                                                    <th>Paid</th>
                                                    <th>Balance</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                            <tfoot class="table-light fw-bold">
                                                                                                <tr>
                                                    <td colspan="3" class="text-end">Total Payout:</td>
                                                    <td id="payrollTotalWages">&#8377;0</td>
                                                    <td id="payrollTotalPaid">&#8377;0</td>
                                                    <td id="payrollTotalBalance">&#8377;0</td>
                                                    <td colspan="2"></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: PRODUCTION -->
                <div id="section-production" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <div>
                            <h1 class="h2 mb-1">Production</h1>
                            <div class="text-muted small">Manage production runs, curing, and ready stock.</div>
                        </div>
                        <div class="section-actions d-flex gap-2 flex-wrap">
                            <button class="btn btn-primary" id="addProductionBtn">
                                <i class="fas fa-hammer me-1"></i> New Production Run
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-sitemap me-1"></i> Masters Setup
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#productMasterModal">Product Master</button></li>
                                    <li><button class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#moldMasterModal">Mould Master</button></li>
                                    <li><button class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#locationMasterModal">Location Master</button></li>
                                </ul>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportProductionPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportProductionCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="productionTabContent">
                        <div class="tab-pane fade show active" id="prodRunsPane" role="tabpanel">
                            <!-- Production Flow Summary -->
                            <div class="row mb-4 g-3">
                                <div class="col-xl-2 col-md-4">
                                    <div class="card border-start-secondary shadow h-100 py-2">
                                        <div class="card-body">
                                            <div class="text-xs fw-bold text-secondary text-uppercase mb-1">In Production</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="prodInProductionCount">0</div>
                                            <small class="text-muted">Started</small>
                                        </div>
                                    </div>
                                </div>
                        <div class="col-xl-2 col-md-4">
                            <div class="card border-start-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="text-xs fw-bold text-warning text-uppercase mb-1">Curing</div>
                                    <div class="h5 mb-0 fw-bold text-gray-800" id="prodCuringCount">0</div>
                                    <small class="text-muted">In Curing</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2 col-md-4">
                            <div class="card border-start-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="text-xs fw-bold text-success text-uppercase mb-1">Produced</div>
                                    <div class="h5 mb-0 fw-bold text-gray-800" id="prodCompletedCount">0</div>
                                    <small class="text-muted">Completed</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card border-start-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="text-xs fw-bold text-info text-uppercase mb-1">Septic Allocation</div>
                                    <div class="h5 mb-0 fw-bold text-gray-800" id="prodSepticAllocated">0</div>
                                    <small class="text-muted">Allocated</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="card border-start-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="text-xs fw-bold text-primary text-uppercase mb-1">Available Stock</div>
                                    <div class="h5 mb-0 fw-bold text-gray-800" id="prodAvailableQty">0</div>
                                    <small class="text-muted">Sellable</small>
                                </div>
                            </div>
                        </div>
                    </div>

                            <!-- Curing Status Cards -->
                            <div class="row mb-4" id="curingStatsContainer">
                                <!-- Populated by JS -->
                            </div>

                            <div class="card shadow-sm mb-4">
                                <div class="card-body d-flex flex-wrap gap-3 align-items-center justify-content-between">
                                    <div class="text-muted small">Status Timeline</div>
                                    <div class="d-flex gap-3 flex-wrap">
                                        <span class="badge bg-secondary">Started: <span id="prodStartedCount">0</span></span>
                                        <span class="badge bg-warning text-dark">On Curing: <span id="prodOnCuringCount">0</span></span>
                                        <span class="badge bg-success">Ready: <span id="prodReadyCount">0</span></span>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow-sm mb-4">
                                <div class="card-body">
                                    <div class="row g-3 align-items-end">
                                        <div class="col-md-4">
                                            <label class="form-label">Search</label>
                                            <input type="text" class="form-control" id="productionSearch" placeholder="Search product, location, batch...">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Stage</label>
                                            <select class="form-select" id="productionStageFilter">
                                                <option value="all">All Stages</option>
                                                <option value="Started">Started</option>
                                                <option value="On Curing">On Curing</option>
                                                <option value="Completed">Completed</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">From</label>
                                            <input type="date" class="form-control" id="productionDateFrom">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">To</label>
                                            <input type="date" class="form-control" id="productionDateTo">
                                        </div>
                                        <div class="col-md-1 d-grid">
                                            <button class="btn btn-outline-secondary" id="resetProductionFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow-sm mb-4">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
                                    <h6 class="m-0 fw-bold text-primary">Labour Payment Tracker</h6>
                                    <div class="d-flex align-items-center gap-2 flex-wrap">
                                        <div class="small text-muted">Batch-wise summary. Use View for date-wise actions.</div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3 mb-3 align-items-end">
                                        <div class="col-md-3">
                                            <label class="form-label">Search</label>
                                            <input type="text" class="form-control" id="labourPayableSearch" placeholder="Search batch, product, worker...">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">Status</label>
                                            <select class="form-select" id="labourPayableStatusFilter">
                                                <option value="all">All</option>
                                                <option value="pending">Pending</option>
                                                <option value="approved">Approved</option>
                                                <option value="partial">Partial</option>
                                                <option value="paid">Paid</option>
                                                <option value="reversed">Reversed</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">Worker</label>
                                            <input type="text" class="form-control" id="labourPayableWorkerFilter" placeholder="Worker name">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">From</label>
                                            <input type="date" class="form-control" id="labourPayableDateFrom">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">To</label>
                                            <input type="date" class="form-control" id="labourPayableDateTo">
                                        </div>
                                        <div class="col-md-1 d-grid">
                                            <button class="btn btn-outline-secondary" id="resetLabourPayableFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                        </div>
                                    </div>
                                    <div class="row g-3 mb-3">
                                        <div class="col-md-3">
                                            <div class="border rounded p-3 bg-light h-100">
                                                <div class="small text-muted">Total Amount</div>
                                                <div class="h5 mb-0 fw-bold" id="labourTotalRecorded">₹0.00</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3 bg-light h-100">
                                                <div class="small text-muted">Total Pending Amount</div>
                                                <div class="h5 mb-0 fw-bold text-danger" id="labourPendingAmount">₹0.00</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3 bg-light h-100">
                                                <div class="small text-muted">Total Entries</div>
                                                <div class="h5 mb-0 fw-bold" id="labourTotalEntries">0</div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="border rounded p-3 bg-light h-100">
                                                <div class="small text-muted">Unique Labours</div>
                                                <div class="h5 mb-0 fw-bold" id="labourUniqueWorkers">0</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-sm table-hover" id="labourPaymentsTable">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Batch</th>
                                                    <th>Date Range</th>
                                                    <th>Product</th>
                                                    <th>Workers</th>
                                                    <th class="text-end">Due</th>
                                                    <th class="text-end">Paid</th>
                                                    <th class="text-end">Pending</th>
                                                    <th>Status</th>
                                                    <th>History</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">RCC Pipe Production Runs</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover production-table" id="productionTablePipes">
                                            <thead>
                                                <tr>
                                                    <th>Date / Batch</th>
                                                    <th>Product</th>
                                                    <th>Quantity Flow</th>
                                                    <th>Stage</th>
                                                    <th>Locations</th>
                                                    <th>Quick Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Septic Tank Assembly Runs</h6>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover production-table" id="productionTableSeptic">
                                            <thead>
                                                <tr>
                                                    <th>Date / Batch</th>
                                                    <th>Product</th>
                                                    <th>Quantity Flow</th>
                                                    <th>Stage</th>
                                                    <th>Locations</th>
                                                    <th>Quick Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                                            </div>
                </div>

                <!-- SECTION: VEHICLES -->
                <div id="section-vehicles" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Vehicle Management</h1>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-outline-warning me-2" id="expiryReportBtn">
                                <i class="fas fa-file-contract me-1"></i> Expiry Report
                            </button>
                            <button class="btn btn-primary" id="addVehicleBtn">
                                <i class="fas fa-truck-medical me-1"></i> Add Vehicle
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportVehiclesPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportVehiclesCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-3">
                        <div class="card-body">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-5">
                                    <label class="form-label">Search</label>
                                    <input type="text" class="form-control" id="vehicleSearch" placeholder="Search vehicle, owner, model...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Type</label>
                                    <select class="form-select" id="vehicleTypeFilter">
                                        <option value="all">All Types</option>
                                        <option value="Truck">Truck</option>
                                        <option value="Trolley">Trolley</option>
                                        <option value="JCB">JCB</option>
                                        <option value="Mixer">Mixer</option>
                                        <option value="Car">Car</option>
                                        <option value="Bike">Bike</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Document Status</label>
                                    <select class="form-select" id="vehicleStatusFilter">
                                        <option value="all">All Status</option>
                                        <option value="ok">OK</option>
                                        <option value="expiring">Expiring Soon</option>
                                        <option value="expired">Expired</option>
                                    </select>
                                </div>
                                <div class="col-md-1 d-grid">
                                    <button class="btn btn-outline-secondary" id="resetVehicleFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" id="vehiclesContainer">
                        <!-- Vehicle Cards Loaded Here -->
                    </div>

                    <div class="card shadow mt-4">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 fw-bold text-primary">Recent Vehicle Expenses & Maintenance</h6>
                            <button class="btn btn-sm btn-outline-primary" id="addExpenseBtn">
                                <i class="fas fa-receipt me-1"></i> Add Expense
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row g-3 mb-3">
                                <div class="col-md-5">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="vehicleExpenseSearch" placeholder="Search expenses...">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="vehicleExpenseTypeFilter">
                                        <option value="all">All Types</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <input type="date" class="form-control" id="vehicleExpenseFrom">
                                </div>
                                <div class="col-md-2">
                                    <input type="date" class="form-control" id="vehicleExpenseTo">
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover" id="vehicleExpensesTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Vehicle</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Cost</th>
                                            <th>Odometer</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="text-center">Loading expenses...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: CUSTOMERS -->
                <div id="section-customers" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Customer Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button class="btn btn-primary me-2" id="addCustomerBtn">
                                <i class="fas fa-user-plus me-1"></i> Add Customer
                            </button>
                            <div class="btn-group me-2">
                                <button class="btn btn-outline-secondary" id="importCustomersBtn">
                                    <i class="fas fa-upload me-1"></i> Import
                                </button>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportCustomersPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportCustomersCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">Total Customers</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_totalCustomers">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-users fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-success text-uppercase mb-1">Active Customers</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_activeCustomers">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-user-check fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-info text-uppercase mb-1">Leads</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_leadCustomers">0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-bullhorn fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-start-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">Revenue</div>
                                            <div class="h5 mb-0 fw-bold text-gray-800" id="cust_customerRevenue">&#8377;0</div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-rupee-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-controls mb-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="searchCustomers" placeholder="Search customers...">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="filterType">
                                    <option value="all">All Types</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select class="form-select" id="filterCustomerStatus">
                                    <option value="all">All Status</option>
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="customersTable">
                                    <thead>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Phone</th>
                                            <th>Company</th>
                                            <th>Type</th>
                                            <th>Orders</th>
                                            <th>Total Spent</th>
                                            <th>Status</th>
                                            <th>Last Contact</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: ORDERS -->
                <div id="section-projects" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Orders</h1>
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary" id="addProjectBtn">
                                <i class="fas fa-plus me-1"></i> New Order
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportProjectsPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportProjectsCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-3">
                        <div class="card-body">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label">Search</label>
                                    <input type="text" class="form-control" id="orderSearch" placeholder="Search order or customer...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="orderStatusFilter">
                                        <option value="all">All Status</option>
                                        <option value="Pending">Pending</option>
                                        <option value="Processing">Processing</option>
                                        <option value="Dispatched">Dispatched</option>
                                        <option value="Completed">Completed</option>
                                        <option value="Cancelled">Cancelled</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">From</label>
                                    <input type="date" class="form-control" id="orderDateFrom">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">To</label>
                                    <input type="date" class="form-control" id="orderDateTo">
                                </div>
                                <div class="col-md-1 d-grid">
                                    <button class="btn btn-outline-secondary" id="resetOrderFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-3 col-6">
                            <div class="card border-start-primary shadow-sm h-100">
                                <div class="card-body py-3">
                                    <div class="small text-muted text-uppercase">Orders Shown</div>
                                    <div class="h5 mb-0 fw-bold" id="orderMetricCount">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="card border-start-warning shadow-sm h-100">
                                <div class="card-body py-3">
                                    <div class="small text-muted text-uppercase">Open Orders</div>
                                    <div class="h5 mb-0 fw-bold text-warning" id="orderMetricPending">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="card border-start-danger shadow-sm h-100">
                                <div class="card-body py-3">
                                    <div class="small text-muted text-uppercase">Overdue Delivery</div>
                                    <div class="h5 mb-0 fw-bold text-danger" id="orderMetricDispatchDue">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="card border-start-success shadow-sm h-100">
                                <div class="card-body py-3">
                                    <div class="small text-muted text-uppercase">Order Value</div>
                                    <div class="h5 mb-0 fw-bold text-success" id="orderMetricValue">&#8377;0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="projectsTable">
                                    <thead>
                                        <tr>
                                            <th>Order Ref</th>
                                            <th>Order Name</th>
                                            <th>Customer</th>
                                            <th>Status</th>
                                            <th>Order Date</th>
                                            <th>Delivery Date</th>
                                            <th>Total</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: INVOICES -->
                <div id="section-invoices" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Invoices</h1>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-primary" id="createInvoiceBtn">
                                <i class="fas fa-plus me-1"></i> Create Invoice
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportInvoicesPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportInvoicesCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow mt-4" id="invoiceFormContainer">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="m-0 fw-bold text-primary">Create Invoice</h6>
                            <div class="d-flex gap-2">
                                <select class="form-select form-select-sm" id="invoiceLayoutSelect" style="width: 240px;">
                                    <option value="original">Original</option>
                                    <option value="corporate">Professional Corporate Structure</option>
                                    <option value="accounting">Professional Accounting Layout</option>
                                    <option value="manufacturing">Professional Manufacturing Invoice Layout</option>
                                    <option value="clean-grid">Professional Clean Grid Layout</option>
                                    <option value="print-optimized">Professional Print Optimized Layout</option>
                                </select>
                                <div class="dropdown" data-bs-auto-close="outside">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="invoiceCopyDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-copy me-1"></i><span id="invoiceCopySummary">Original</span>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end p-2" style="min-width: 220px;">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="invoiceCopyAll">
                                            <label class="form-check-label fw-semibold" for="invoiceCopyAll">All Copies</label>
                                        </div>
                                        <hr class="my-2">
                                        <div class="form-check">
                                            <input class="form-check-input invoice-copy-checkbox" type="checkbox" value="Original" id="invoiceCopyOriginal" checked>
                                            <label class="form-check-label" for="invoiceCopyOriginal">Original</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input invoice-copy-checkbox" type="checkbox" value="Duplicate" id="invoiceCopyDuplicate">
                                            <label class="form-check-label" for="invoiceCopyDuplicate">Duplicate</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input invoice-copy-checkbox" type="checkbox" value="Triplicate" id="invoiceCopyTriplicate">
                                            <label class="form-check-label" for="invoiceCopyTriplicate">Triplicate</label>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" id="printInvoicePreviewBtn"><i class="fas fa-print me-1"></i>Print Selected</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-lg-6">
                                    <form id="invoiceForm">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Customer</label>
                                                <select class="form-select" id="invCustomerSelect"></select>
                                            </div>
                                            <div class="col-md-6 d-flex align-items-end">
                                                <div class="form-check mt-3">
                                                    <input class="form-check-input" type="checkbox" id="invShipSame" checked>
                                                    <label class="form-check-label" for="invShipSame">Ship To same as Bill To</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Invoice Date</label>
                                                <input type="date" class="form-control" id="invDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Order / Project</label>
                                                <select class="form-select" id="invProjectSelect"></select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">PO Number</label>
                                                <input type="text" class="form-control" id="invPoNumber">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">PO Date</label>
                                                <input type="date" class="form-control" id="invPoDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Vehicle</label>
                                                <select class="form-select" id="invVehicle"></select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Driver</label>
                                                <input type="text" class="form-control" id="invDriver">
                                            </div>
                                            <div class="col-12">
                                                <div class="border rounded p-2 bg-light small text-muted">Ship To Details (if different)</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Ship To Name</label>
                                                <input type="text" class="form-control" id="invShipName">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Ship To Phone</label>
                                                <input type="text" class="form-control" id="invShipPhone">
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Ship To Address</label>
                                                <input type="text" class="form-control" id="invShipAddress">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">State</label>
                                                <select class="form-select" id="invShipState">
                                                    <option value="">Select State</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Pincode</label>
                                                <input type="text" class="form-control" id="invShipZip">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">GSTIN</label>
                                                <input type="text" class="form-control" id="invShipTaxId">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Village</label>
                                                <select class="form-select" id="invShipVillage">
                                                    <option value="">Select Village</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">District</label>
                                                <select class="form-select" id="invShipDistrict">
                                                    <option value="">Select District</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Mandal</label>
                                                <select class="form-select" id="invShipMandal">
                                                    <option value="">Select Mandal</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="table-responsive mt-3">
                                            <table class="table table-sm align-middle" id="invItemsTable">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Item</th>
                                                        <th>Qty</th>
                                                        <th>Price</th>
                                                        <th>Total</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="invItemsContainer"></tbody>
                                                <tfoot>
                                                    <tr>
                                                        <td colspan="3" class="text-end">Transport Cost:</td>
                                                        <td colspan="2"><input type="number" class="form-control form-control-sm text-end" id="invTransportCost" value="0"></td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="3" class="text-end">Amount Paid:</td>
                                                        <td colspan="2"><input type="number" class="form-control form-control-sm text-end" id="invAmountPaid" value="0"></td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="3" class="text-end">Balance Due:</td>
                                                        <td colspan="2" class="text-end fw-bold text-danger" id="invBalance">Ã¢â€šÂ¹0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="3" class="text-end fw-bold">Grand Total:</td>
                                                        <td colspan="2" class="fw-bold text-primary" id="invGrandTotal">Ã¢â€šÂ¹0.00</td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                        <button type="button" class="btn btn-outline-primary btn-sm" id="invAddItemBtn"><i class="fas fa-plus me-1"></i>Add Item</button>

                                        <div class="mb-3 mt-3">
                                            <label class="form-label fw-bold">Customer Signature</label>
                                            <div class="border rounded p-2 bg-light text-center">
                                                <canvas id="signaturePad" width="400" height="150" class="bg-white border shadow-sm" style="touch-action: none;"></canvas>
                                                <div class="mt-2 text-end">
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="clearSignatureBtn"><i class="fas fa-eraser me-1"></i>Clear</button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="text-end">
                                            <button type="button" class="btn btn-primary" id="saveInvoiceBtn">Create Invoice</button>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-lg-6 invoice-preview-col">
                                    <div class="border rounded bg-white invoice-preview-wrap" style="min-height: 700px;">
                                        <div class="invoice-thumbs-overlay" id="invoiceTemplateThumbs">
                                            <div class="d-flex gap-2" id="invoiceTemplateThumbList"></div>
                                        </div>
                                        <iframe id="invoicePreviewFrame" style="border: none; width: 100%; height: 100%;" title="Invoice Preview"></iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-3 mt-4">
                        <div class="card-body">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label">Search</label>
                                    <input type="text" class="form-control" id="invoiceSearch" placeholder="Search invoice or customer...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="invoiceStatusFilter">
                                        <option value="all">All Status</option>
                                        <option value="Paid">Paid</option>
                                        <option value="Pending">Pending</option>
                                        <option value="Overdue">Overdue</option>
                                        <option value="Draft">Draft</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">From</label>
                                    <input type="date" class="form-control" id="invoiceDateFrom">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">To</label>
                                    <input type="date" class="form-control" id="invoiceDateTo">
                                </div>
                                <div class="col-md-1 d-grid">
                                    <button class="btn btn-outline-secondary" id="resetInvoiceFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="invoicesTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Invoice #</th>
                                            <th>Customer</th>
                                            <th class="text-end">Amount</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: GST BILLING -->
                <div id="section-gst" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <div>
                            <h1 class="h2">GST Billing</h1>
                            <div class="text-muted small">Tax Invoice, Credit Note, Debit Note, Delivery Challan, E-way Bill info.</div>
                        </div>
                        <div class="d-flex gap-2 flex-wrap">
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportGstCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                    <li><button class="dropdown-item" id="exportGstPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-3">
                        <div class="card-body">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label">Search</label>
                                    <input type="text" class="form-control" id="gstSearch" placeholder="Search invoice/customer...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Type</label>
                                    <select class="form-select" id="gstTypeFilter">
                                        <option value="all">All</option>
                                        <option value="Tax Invoice">Tax Invoice</option>
                                        <option value="Credit Note">Credit Note</option>
                                        <option value="Debit Note">Debit Note</option>
                                        <option value="Delivery Challan">Delivery Challan</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">From</label>
                                    <input type="date" class="form-control" id="gstDateFrom">
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">To</label>
                                    <input type="date" class="form-control" id="gstDateTo">
                                </div>
                                <div class="col-md-1 d-grid">
                                    <button class="btn btn-outline-secondary" id="resetGstFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="gstTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Doc #</th>
                                            <th>Type</th>
                                            <th>Customer</th>
                                            <th class="text-end">Amount</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow" id="gstFormContainer">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="m-0 fw-bold text-primary">Create GST Document</h6>
                            <div class="d-flex gap-2">
                                <select class="form-select form-select-sm" id="gstDocType" style="width: 180px;">
                                    <option value="Tax Invoice">Tax Invoice</option>
                                    <option value="Credit Note">Credit Note</option>
                                    <option value="Debit Note">Debit Note</option>
                                    <option value="Delivery Challan">Delivery Challan</option>
                                </select>
                                <select class="form-select form-select-sm" id="gstTaxMode" style="width: 170px;">
                                    <option value="CGST_SGST">CGST + SGST</option>
                                    <option value="IGST">IGST (Inter-State)</option>
                                </select>
                                <button class="btn btn-sm btn-outline-primary" id="printGstPreviewBtn"><i class="fas fa-print me-1"></i>Print</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-lg-6">
                                    <form id="gstForm">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Customer</label>
                                                <select class="form-select" id="gstCustomer"></select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Date</label>
                                                <input type="date" class="form-control" id="gstDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Place of Supply</label>
                                                <select class="form-select" id="gstPlaceOfSupply">
                                                    <option value="">Select State</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Reverse Charge</label>
                                                <select class="form-select" id="gstReverseCharge">
                                                    <option value="No">No</option>
                                                    <option value="Yes">Yes</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">E-way Bill No</label>
                                                <input type="text" class="form-control" id="gstEwayBill">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Transporter</label>
                                                <input type="text" class="form-control" id="gstTransporter">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Vehicle</label>
                                                <input type="text" class="form-control" id="gstVehicle">
                                            </div>
                                        </div>

                                          <div class="table-responsive mt-3">
                                              <table class="table table-sm align-middle" id="gstItemsTable">
                                                  <thead class="table-light">
                                                      <tr>
                                                          <th>Item</th>
                                                          <th>HSN/SAC</th>
                                                          <th>GST%</th>
                                                          <th class="text-end">Qty</th>
                                                          <th class="text-end">Price</th>
                                                          <th class="text-end">Total</th>
                                                          <th></th>
                                                      </tr>
                                                  </thead>
                                                  <tbody id="gstItemsContainer"></tbody>
                                                  <tfoot>
                                                      <tr>
                                                          <td colspan="5" class="text-end">Transport Cost:</td>
                                                          <td colspan="2"><input type="number" class="form-control form-control-sm text-end" id="gstTransportCost" value="0"></td>
                                                      </tr>
                                                      <tr>
                                                          <td colspan="5" class="text-end">Amount Paid:</td>
                                                          <td colspan="2"><input type="number" class="form-control form-control-sm text-end" id="gstAmountPaid" value="0"></td>
                                                      </tr>
                                                      <tr>
                                                          <td colspan="5" class="text-end fw-bold">Grand Total:</td>
                                                          <td colspan="2" class="fw-bold text-primary" id="gstGrandTotal">&#8377;0.00</td>
                                                      </tr>
                                                  </tfoot>
                                              </table>
                                          </div>
                                        <button type="button" class="btn btn-outline-primary btn-sm" id="gstAddItemBtn"><i class="fas fa-plus me-1"></i>Add Item</button>

                                        <div class="text-end mt-3">
                                            <button type="button" class="btn btn-primary" id="saveGstBtn">Save GST Document</button>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-lg-6">
                                    <div class="border rounded bg-white" style="height: 100%; min-height: 700px;">
                                        <iframe id="gstPreviewFrame" style="border: none; width: 100%; height: 100%;" title="GST Preview"></iframe>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: PAYMENTS -->
                <div id="section-payments" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <div>
                            <h1 class="h2">Payments</h1>
                            <div class="text-muted small">Track payment in and payment out.</div>
                        </div>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-primary" id="addPaymentInBtn">
                                <i class="fas fa-arrow-down me-1"></i> Payment In
                            </button>
                            <button class="btn btn-outline-danger" id="addPaymentOutBtn">
                                <i class="fas fa-arrow-up me-1"></i> Payment Out
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" id="paymentsViewBtn">
                                    <i class="fas fa-exchange-alt me-1"></i> View: Payment In
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item active" id="paymentInToggle" type="button">Payment In</button></li>
                                    <li><button class="dropdown-item" id="paymentOutToggle" type="button">Payment Out</button></li>
                                </ul>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportPaymentInCsvBtn"><i class="fas fa-file-csv me-2"></i>Payment In CSV</button></li>
                                    <li><button class="dropdown-item" id="exportPaymentOutCsvBtn"><i class="fas fa-file-csv me-2"></i>Payment Out CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <ul class="nav nav-tabs mb-3 d-none" id="paymentsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="payment-in-tab" data-bs-toggle="tab" data-bs-target="#paymentInPane" type="button" role="tab">Payment In</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="payment-out-tab" data-bs-toggle="tab" data-bs-target="#paymentOutPane" type="button" role="tab">Payment Out</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="paymentsTabContent">
                        <div class="tab-pane fade show active" id="paymentInPane" role="tabpanel">
                            <div class="card shadow-sm mb-3">
                                <div class="card-body">
                                    <div class="row g-3 align-items-end">
                                        <div class="col-md-4">
                                            <label class="form-label">Search</label>
                                            <input type="text" class="form-control" id="paymentInSearch" placeholder="Search customer, ref...">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Mode</label>
                                            <select class="form-select" id="paymentInMode">
                                                <option value="all">All Modes</option>
                                                <option value="Cash">Cash</option>
                                                <option value="UPI">UPI</option>
                                                <option value="Bank">Bank</option>
                                                <option value="Cheque">Cheque</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">From</label>
                                            <input type="date" class="form-control" id="paymentInFrom">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">To</label>
                                            <input type="date" class="form-control" id="paymentInTo">
                                        </div>
                                        <div class="col-md-1 d-grid">
                                            <button class="btn btn-outline-secondary" id="resetPaymentInFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2">
                                        <small class="text-muted">Total Payment In</small>
                                        <span class="fw-bold text-success" id="paymentInTotal">Ã¢â€šÂ¹0</span>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="paymentInTable">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Customer</th>
                                                    <th>Mode</th>
                                                    <th>Reference</th>
                                                    <th>Description</th>
                                                    <th class="text-end">Amount</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="paymentOutPane" role="tabpanel">
                            <div class="card shadow-sm mb-3">
                                <div class="card-body">
                                    <div class="row g-3 align-items-end">
                                        <div class="col-md-4">
                                            <label class="form-label">Search</label>
                                            <input type="text" class="form-control" id="paymentOutSearch" placeholder="Search supplier, ref...">
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Mode</label>
                                            <select class="form-select" id="paymentOutMode">
                                                <option value="all">All Modes</option>
                                                <option value="Cash">Cash</option>
                                                <option value="UPI">UPI</option>
                                                <option value="Bank">Bank</option>
                                                <option value="Cheque">Cheque</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">From</label>
                                            <input type="date" class="form-control" id="paymentOutFrom">
                                        </div>
                                        <div class="col-md-2">
                                            <label class="form-label">To</label>
                                            <input type="date" class="form-control" id="paymentOutTo">
                                        </div>
                                        <div class="col-md-1 d-grid">
                                            <button class="btn btn-outline-secondary" id="resetPaymentOutFilters" title="Reset Filters"><i class="fas fa-undo"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between mb-2">
                                        <small class="text-muted">Total Payment Out</small>
                                        <span class="fw-bold text-danger" id="paymentOutTotal">Ã¢â€šÂ¹0</span>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="paymentOutTable">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Supplier</th>
                                                    <th>Mode</th>
                                                    <th>Reference</th>
                                                    <th>Description</th>
                                                    <th class="text-end">Amount</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment In Select Modal -->
                <div class="modal fade" id="paymentInSelectModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Select Invoice</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">Invoice</label>
                                    <select class="form-select" id="paymentInInvoiceSelect">
                                        <option value="">Loading...</option>
                                    </select>
                                    <div class="form-text">Only unpaid/partial invoices are listed.</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button class="btn btn-primary" id="confirmPaymentInSelect">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Out Select Modal -->
                <div class="modal fade" id="paymentOutSelectModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Select Supplier</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">Supplier</label>
                                    <select class="form-select" id="paymentOutSupplierSelect">
                                        <option value="">Loading...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button class="btn btn-danger" id="confirmPaymentOutSelect">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: PROFIT & LOSS -->
                <div id="section-profit-loss" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Profit &amp; Loss</h1>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-outline-primary" id="refreshProfitLossBtn">
                                <i class="fas fa-rotate me-1"></i> Refresh
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="exportProfitLossPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="exportProfitLossCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card pl-card pl-income">
                                <div class="card-body">
                                    <div class="pl-label">Total Income</div>
                                    <div class="pl-value" id="plTotalIncome">&#8377;0</div>
                                    <div class="pl-sub">Invoices + Payments</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card pl-card pl-expense">
                                <div class="card-body">
                                    <div class="pl-label">Total Expenses</div>
                                    <div class="pl-value" id="plTotalExpenses">&#8377;0</div>
                                    <div class="pl-sub">Purchases + Supplier + Vehicle</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card pl-card pl-profit">
                                <div class="card-body">
                                    <div class="pl-label">Net Profit</div>
                                    <div class="pl-value" id="plNetProfit">&#8377;0</div>
                                    <div class="pl-sub">Income - Expenses</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card pl-card pl-margin">
                                <div class="card-body">
                                    <div class="pl-label">Profit Margin</div>
                                    <div class="pl-value" id="plProfitMargin">0%</div>
                                    <div class="pl-sub">Net / Income</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card pl-filters mb-4">
                        <div class="card-body">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-3">
                                    <label class="form-label">From</label>
                                    <input type="date" class="form-control" id="plStartDate">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">To</label>
                                    <input type="date" class="form-control" id="plEndDate">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Type</label>
                                    <select class="form-select" id="plTypeFilter">
                                        <option value="all">All Transactions</option>
                                        <option value="income">Income</option>
                                        <option value="expense">Expense</option>
                                        <option value="invoice">Invoices</option>
                                        <option value="payment">Payments</option>
                                        <option value="supplier">Supplier Payments</option>
                                        <option value="purchase">Purchases</option>
                                        <option value="vehicle">Vehicle Expenses</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Search</label>
                                    <input type="text" class="form-control" id="plSearchInput" placeholder="Search description, party, ref...">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="profitLossTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Party</th>
                                            <th>Reference</th>
                                            <th class="text-end">Amount</th>
                                            <th>Direction</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: AUDIT REPORTS -->
                <div id="section-audit" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <div>
                            <h1 class="h2 mb-1">Audit Reports</h1>
                            <div class="text-muted small">Financial year based audit summary for statutory review and compliance tracking.</div>
                        </div>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-outline-primary" id="refreshAuditBtn">
                                <i class="fas fa-rotate me-1"></i> Refresh
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><button class="dropdown-item" id="auditExportPdfBtn"><i class="fas fa-file-pdf me-2"></i>PDF</button></li>
                                    <li><button class="dropdown-item" id="auditExportCsvBtn"><i class="fas fa-file-csv me-2"></i>CSV</button></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card audit-filter-card mb-4">
                        <div class="card-body">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label">Financial Year</label>
                                    <select class="form-select" id="auditFySelect"></select>
                                </div>
                                <div class="col-md-8">
                                    <div class="audit-note" id="auditReportNote">
                                        Financial statements are prepared from recorded transactions for selected FY.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-xl-4 col-md-6">
                            <div class="card audit-kpi-card">
                                <div class="card-body">
                                    <div class="audit-kpi-label">Gross Revenue (Accrual)</div>
                                    <div class="audit-kpi-value text-primary" id="auditGrossRevenue">&#8377;0</div>
                                    <div class="audit-kpi-sub">Sales invoices raised in FY</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6">
                            <div class="card audit-kpi-card">
                                <div class="card-body">
                                    <div class="audit-kpi-label">Receipts Realized</div>
                                    <div class="audit-kpi-value text-success" id="auditCollectedReceipts">&#8377;0</div>
                                    <div class="audit-kpi-sub">Payments received against invoices</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6">
                            <div class="card audit-kpi-card">
                                <div class="card-body">
                                    <div class="audit-kpi-label">Operating Expenses</div>
                                    <div class="audit-kpi-value text-danger" id="auditOperatingExpense">&#8377;0</div>
                                    <div class="audit-kpi-sub">Supplier, purchase and vehicle expenses</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6">
                            <div class="card audit-kpi-card">
                                <div class="card-body">
                                    <div class="audit-kpi-label">Net Profit (Cash View)</div>
                                    <div class="audit-kpi-value" id="auditNetProfit">&#8377;0</div>
                                    <div class="audit-kpi-sub">Receipts realized minus operating expense</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6">
                            <div class="card audit-kpi-card">
                                <div class="card-body">
                                    <div class="audit-kpi-label">Outstanding Receivables</div>
                                    <div class="audit-kpi-value text-warning" id="auditReceivables">&#8377;0</div>
                                    <div class="audit-kpi-sub">Unrealized customer balances</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4 col-md-6">
                            <div class="card audit-kpi-card">
                                <div class="card-body">
                                    <div class="audit-kpi-label">Outstanding Payables</div>
                                    <div class="audit-kpi-value text-warning" id="auditPayables">&#8377;0</div>
                                    <div class="audit-kpi-sub">Supplier balances payable</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mb-4">
                        <div class="col-lg-8">
                            <div class="card shadow-sm">
                                <div class="card-header">
                                    <h6 class="m-0 fw-bold text-primary">Monthly Audit Trend (FY)</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="auditMonthlyChart" height="120"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card shadow-sm h-100">
                                <div class="card-header">
                                    <h6 class="m-0 fw-bold text-primary">GST & Compliance Snapshot</h6>
                                </div>
                                <div class="card-body">
                                    <div class="audit-compliance-grid">
                                        <div class="audit-compliance-item">
                                            <div class="audit-compliance-label">GST Docs Issued</div>
                                            <div class="audit-compliance-value" id="auditGstDocs">0</div>
                                        </div>
                                        <div class="audit-compliance-item">
                                            <div class="audit-compliance-label">Taxable Turnover</div>
                                            <div class="audit-compliance-value" id="auditTaxableTurnover">&#8377;0</div>
                                        </div>
                                        <div class="audit-compliance-item">
                                            <div class="audit-compliance-label">Estimated GST</div>
                                            <div class="audit-compliance-value" id="auditEstimatedGst">&#8377;0</div>
                                        </div>
                                        <div class="audit-compliance-item">
                                            <div class="audit-compliance-label">GST Invoice Value</div>
                                            <div class="audit-compliance-value" id="auditGstInvoiceValue">&#8377;0</div>
                                        </div>
                                    </div>
                                    <div class="audit-note mt-3" id="auditComplianceNote">No compliance observations yet.</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                            <h6 class="m-0 fw-bold text-primary">Audit Ledger Extract</h6>
                            <small class="text-muted" id="auditLedgerCount">0 entries</small>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="auditLedgerTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Particulars</th>
                                            <th>Voucher/Ref</th>
                                            <th>Category</th>
                                            <th class="text-end">Debit</th>
                                            <th class="text-end">Credit</th>
                                            <th class="text-end">Running Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECTION: PROFILE -->
                <div id="section-profile" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">My Profile</h1>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-4">
                            <div class="card shadow text-center p-4">
                                <div class="avatar-circle-lg bg-primary text-white mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 100px; height: 100px; font-size: 2.5rem; border-radius: 50%;">
                                    <i class="fas fa-user"></i>
                                </div>
                                <h4 id="profileDisplayName" class="mb-1">Loading...</h4>
                                <p id="profileEmail" class="text-muted mb-3">loading...</p>
                                <div class="badge bg-success mb-3">Pro Plan</div>
                            </div>
                        </div>

                        <div class="col-md-8">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Personal Details</h6>
                                </div>
                                <div class="card-body">
                                    <form id="profileForm">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">First Name</label>
                                                <input type="text" class="form-control" id="profileFirstName">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Last Name</label>
                                                <input type="text" class="form-control" id="profileLastName">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" id="profilePhone">
                                            </div>
                                            <div class="col-12 text-end">
                                                <button type="submit" class="btn btn-primary" id="saveProfileBtn">Save Changes</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- SECTION: SETTINGS -->
                <div id="section-settings" class="main-section d-none">
                    <div class="section-header d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="h2">Business Settings</h1>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Company Information</h6>
                                </div>
                                <div class="card-body">
                                    <form id="settingsForm">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Company Name</label>
                                                <input type="text" class="form-control" id="companyName" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Tax ID / GSTIN</label>
                                                <input type="text" class="form-control" id="taxId">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">UPI ID (for QR Code)</label>
                                                <input type="text" class="form-control" id="companyUpiId" placeholder="username@bank">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Default GST %</label>
                                                <input type="number" class="form-control" id="companyGstRate" step="0.01" value="18">
                                            </div>
                                              <div class="col-md-6">
                                                  <label class="form-label">Invoice Prefix</label>
                                                  <input type="text" class="form-control" id="invoicePrefix" placeholder="e.g. 2026">
                                              </div>
                                              <div class="col-md-6">
                                                  <label class="form-label">Invoice Padding</label>
                                                  <input type="number" class="form-control" id="invoicePad" value="4" min="2" max="10">
                                              </div>
                                              <div class="col-md-6">
                                                  <label class="form-label">GST Doc Prefix</label>
                                                  <input type="text" class="form-control" id="gstInvoicePrefix" placeholder="e.g. GST/2026">
                                              </div>
                                              <div class="col-md-6">
                                                  <label class="form-label">GST Doc Padding</label>
                                                  <input type="number" class="form-control" id="gstInvoicePad" value="4" min="2" max="10">
                                              </div>
                                              <div class="col-md-6">
                                                  <label class="form-label">GST Next Number</label>
                                                  <input type="number" class="form-control" id="gstInvoiceNextNumber" value="1" min="1">
                                              </div>
                                              <div class="col-md-6">
                                                  <label class="form-label">Business Email</label>
                                                  <input type="email" class="form-control" id="companyEmail">
                                              </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Business Phone</label>
                                                <input type="text" class="form-control" id="companyPhone">
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Address</label>
                                                <input type="text" class="form-control" id="companyAddress">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">State</label>
                                                <select class="form-select" id="companyState">
                                                    <option value="">Select State</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Pincode</label>
                                                <input type="text" class="form-control" id="companyZip">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Village</label>
                                                <select class="form-select" id="companyVillage">
                                                    <option value="">Select Village</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">District</label>
                                                <select class="form-select" id="companyDistrict">
                                                    <option value="">Select District</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Mandal</label>
                                                <select class="form-select" id="companyMandal">
                                                    <option value="">Select Mandal</option>
                                                </select>
                                            </div>
                                            
                                            <div class="col-12"><hr class="my-2"></div>
                                            <h6 class="fw-bold text-secondary mb-0">Bank Details</h6>

                                            <div class="col-md-6">
                                                <label class="form-label">Account Holder Name</label>
                                                <input type="text" class="form-control" id="companyBankAccountName" placeholder="Account holder">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Account Number</label>
                                                <input type="text" class="form-control" id="companyBankAccountNo" placeholder="Account number">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">IFSC Code</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control" id="companyBankIfsc" placeholder="IFSC">
                                                    <button class="btn btn-outline-secondary" type="button" onclick="window.open('https://www.rbi.org.in/Scripts/IFSCMICRDetails.aspx','_blank')">Find IFSC</button>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Bank Name</label>
                                                <input type="text" class="form-control" id="companyBankName" placeholder="Bank name">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Branch</label>
                                                <input type="text" class="form-control" id="companyBankBranch" placeholder="Branch">
                                            </div>
                                            
                                            <div class="col-12"><hr class="my-2"></div>
                                            <h6 class="fw-bold text-secondary mb-0">Branding & Documents</h6>
                                            
                                            <div class="col-md-6">
                                                <label class="form-label">Company Logo</label>
                                                <input type="file" class="form-control" id="companyLogo" accept="image/*">
                                                <div id="logoPreview" class="mt-2 d-flex align-items-center gap-2"></div>
                                                <input type="hidden" id="logoUrl">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Authorized Signature</label>
                                                <input type="file" class="form-control" id="companySignature" accept="image/*">
                                                <div id="signaturePreview" class="mt-2 d-flex align-items-center gap-2"></div>
                                                <input type="hidden" id="signatureUrl">
                                            </div>

                                            <div class="col-md-6">
                                                <label class="form-label">Currency</label>
                                                <select class="form-select" id="currency" disabled>
                                                    <option value="INR" selected>Indian Rupee (&#8377;)</option>
                                                </select>
                                            </div>
                                            <div class="col-12 mt-4 text-end">
                                                <button type="submit" class="btn btn-primary" id="saveSettingsBtn">
                                                    <i class="fas fa-save me-2"></i>Save Business Settings
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Preferences</h6>
                                </div>
                                <div class="card-body">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="emailNotifs" checked>
                                        <label class="form-check-label" for="emailNotifs">Email Notifications</label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="lowStockAlerts" checked>
                                        <label class="form-check-label" for="lowStockAlerts">Low Stock Alerts</label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="autoExpiryReports" checked>
                                        <label class="form-check-label" for="autoExpiryReports">Automatic Expiry Reports</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="darkModeToggle">
                                        <label class="form-check-label" for="darkModeToggle">Dark Mode (Beta)</label>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Owner Access</h6>
                                </div>
                                <div class="card-body">
                                    <label class="form-label">Login Password</label>
                                    <input type="password" class="form-control mb-2" id="ownerLoginPassword" placeholder="Set owner login password">
                                    <small class="text-muted d-block mb-3">This password protects the login page. It is stored as a hash.</small>
                                    <button class="btn btn-outline-primary w-100" id="saveOwnerPasswordBtn">
                                        <i class="fas fa-lock me-2"></i>Save Password
                                    </button>
                                    <div class="small text-muted mt-2" id="ownerPasswordStatus"></div>
                                </div>
                            </div>

                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Account Security</h6>
                                </div>
                                <div class="card-body">
                                    <form id="settingsPasswordForm">
                                        <label class="form-label">New Account Password</label>
                                        <input type="password" class="form-control mb-2" id="settingsNewPassword" minlength="6" placeholder="Enter new password" autocomplete="new-password">
                                        <input type="password" class="form-control mb-2" id="settingsConfirmPassword" minlength="6" placeholder="Confirm password" autocomplete="new-password">
                                        <small class="text-muted d-block mb-3">
                                            Note: If you logged in with Google, setting a password here will disable Google Sign-In for this account.
                                        </small>
                                        <button type="submit" class="btn btn-outline-warning w-100" id="saveSettingsPasswordBtn">
                                            <i class="fas fa-key me-2"></i>Update Account Password
                                        </button>
                                        <div class="small text-muted mt-2" id="settingsPasswordStatus"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 fw-bold text-primary">Data Backup</h6>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted small mb-3">Backup all business data to your computer for recovery.</p>
                                    <button class="btn btn-outline-primary w-100" id="backupToComputerBtn">
                                        <i class="fas fa-download me-2"></i>Backup to Computer
                                    </button>
                                    <button class="btn btn-outline-danger w-100 mt-2" id="restoreFromComputerBtn">
                                        <i class="fas fa-upload me-2"></i>Restore from Computer
                                    </button>
                                    <div class="small text-muted mt-2" id="backupStatus"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Team Management Card -->
                        <div class="col-12 mt-4" id="teamManagementCard">
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 fw-bold text-primary">Team Access (Max 3 Users)</h6>
                                    <button class="btn btn-sm btn-primary" id="addTeamMemberBtn"><i class="fas fa-user-plus me-1"></i> Add Member</button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="teamTable">
                                            <thead>
                                                <tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

    <!-- Mobile Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- MODALS -->
    <!-- Item History Modal -->
    <div class="modal fade" id="itemHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Item History: <span id="historyItemName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-sm table-hover" id="itemHistoryTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Quantity</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Raw Material Modal -->
    <div class="modal fade" id="rawMaterialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rmModalTitle">Add Raw Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="rawMaterialForm">
                        <div class="mb-3">
                            <label class="form-label">Material Name</label>
                            <input type="text" class="form-control" id="rmName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Material Category</label>
                            <select class="form-select" id="rmCategory">
                                <option value="Cement">Cement</option>
                                <option value="Sand">Sand</option>
                                <option value="Dust">Dust</option>
                                <option value="Aggregate">Aggregate</option>
                                <option value="Steel">Steel</option>
                            </select>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">Unit</label>
                                <select class="form-select" id="rmUnit">
                                    <option value="Bag">Bag</option>
                                    <option value="Ton">Ton</option>
                                    <option value="CFT">CFT</option>
                                    <option value="Kg">Kg</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Standard Rate (&#8377;)</label>
                                <input type="number" class="form-control" id="rmStandardRate" step="0.01">
                            </div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">Minimum Stock Alert Level</label>
                                <input type="number" class="form-control" id="rmReorder" value="100">
                            </div>
                            <div class="col-6">
                                <label class="form-label">Quantity</label>
                                <input type="number" class="form-control" id="rmQuantity" value="0" readonly>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Supplier (Default Supplier)</label>
                            <select class="form-select" id="rmSupplier"></select>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">Storage Location</label>
                                <input type="text" class="form-control" id="rmLocation">
                            </div>
                            <div class="col-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="rmStatus">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-text">Quantity increases only through supplier purchase entries.</div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveRawMaterialBtn">Save Material</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="customerEmail">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="text" class="form-control" id="customerPhone">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Company</label>
                                <input type="text" class="form-control" id="customerCompany">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="customerType">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="customerStatus">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                    <option value="Lead">Lead</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control" id="customerAddress">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">State</label>
                                <select class="form-select" id="customerState">
                                    <option value="">Select State</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Pincode</label>
                                <input type="text" class="form-control" id="customerZip">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Village</label>
                                <select class="form-select" id="customerVillage">
                                    <option value="">Select Village</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">District</label>
                                <select class="form-select" id="customerDistrict">
                                    <option value="">Select District</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Mandal</label>
                                <select class="form-select" id="customerMandal">
                                    <option value="">Select Mandal</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Services Interested In</label>
                                <select class="form-select" id="services" multiple>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="customerNotes" rows="3"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tax ID (Optional)</label>
                                <input type="text" class="form-control" id="customerTaxId">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveCustomerBtn">Save Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div class="modal fade" id="projectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Order Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="projectForm">
                        <div class="mb-3">
                            <label class="form-label">Order Name</label>
                            <input type="text" class="form-control" id="projectName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Customer</label>
                            <div class="input-group">
                                <select class="form-select" id="projectCustomerId" required>
                                    <option value="">Select Customer</option>
                                </select>
                                <button class="btn btn-outline-primary" type="button" id="addOrderCustomerBtn" title="Add New Customer">
                                    <i class="fas fa-user-plus"></i>
                                </button>
                            </div>
                            <div class="form-text">Pick from existing customers or add a new customer instantly.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="projectStatus">
                                <option value="Pending">Pending</option>
                                <option value="Processing">Processing</option>
                                <option value="Dispatched">Dispatched</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="mb-3">
    <label class="form-label">Order Date</label>
    <input type="date" class="form-control" id="projectOrderDate">
</div>
<div class="mb-3">
    <label class="form-label">Delivery Date</label>
    <input type="date" class="form-control" id="projectDeliveryDate">
</div>
<div class="mb-3">
    <label class="form-label">Notes</label>
    <textarea class="form-control" id="projectNotes" rows="2"></textarea>
</div>
<div class="mb-3">
    <div class="d-flex align-items-center justify-content-between mb-2">
        <label class="form-label mb-0">Order Items</label>
        <button type="button" class="btn btn-sm btn-outline-primary" id="orderAddItemBtn">
            <i class="fas fa-plus me-1"></i> Add Item
        </button>
    </div>
    <div class="table-responsive">
        <table class="table table-sm align-middle mb-2">
            <thead class="table-light">
                <tr>
                    <th style="width: 45%;">Item</th>
                    <th style="width: 15%;">Qty</th>
                    <th style="width: 20%;">Price</th>
                    <th style="width: 15%;">Total</th>
                    <th style="width: 5%;"></th>
                </tr>
            </thead>
            <tbody id="orderItemsContainer"></tbody>
        </table>
    </div>
    <div class="text-end fw-semibold">Order Total: <span id="orderGrandTotal">&#8377;0.00</span></div>
</div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveProjectBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div class="modal fade" id="paymentHistoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Payment History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3 p-2 bg-light rounded border">
                        <div class="d-flex justify-content-between">
                            <span>Invoice: <strong id="phInvoiceNo"></strong></span>
                            <span>Balance: <strong id="phBalance" class="text-danger"></strong></span>
                        </div>
                    </div>
                    
                    <div class="table-responsive mb-3">
                        <table class="table table-sm table-bordered" id="paymentHistoryTable">
                            <thead class="table-light">
                                <tr><th>Date</th><th>Mode</th><th>Ref</th><th class="text-end">Amount</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <hr>
                    <h6 class="mb-3 text-primary">Record New Payment</h6>
                    <form id="paymentForm">
                        <div class="row g-2">
                            <div class="col-6"><label class="form-label small">Date</label><input type="date" class="form-control form-control-sm" id="payDate" required></div>
                            <div class="col-6"><label class="form-label small">Amount (&#8377;)</label><input type="number" class="form-control form-control-sm" id="payAmount" required min="1"></div>
                            <div class="col-6"><label class="form-label small">Mode</label><select class="form-select form-select-sm" id="payMode"><option value="Cash">Cash</option><option value="UPI">UPI</option><option value="Bank Transfer">Bank Transfer</option><option value="Cheque">Cheque</option></select></div>
                            <div class="col-6"><label class="form-label small">Reference / Note</label><input type="text" class="form-control form-control-sm" id="payRef" placeholder="Txn ID / Cheque No"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="savePaymentBtn">Record Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Advance Payment Modal -->
    <div class="modal fade" id="advancePaymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Advance Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="advancePaymentForm">
                        <input type="hidden" id="advCustomerId">
                        <div class="mb-3">
                            <label class="form-label">Customer</label>
                            <input type="text" class="form-control" id="advCustomerName" readonly>
                        </div>
                        <div class="row g-2">
                            <div class="col-6"><label class="form-label">Date</label><input type="date" class="form-control" id="advDate" required></div>
                            <div class="col-6"><label class="form-label">Amount (&#8377;)</label><input type="number" class="form-control" id="advAmount" required min="1"></div>
                            <div class="col-6"><label class="form-label">Mode</label><select class="form-select" id="advMode"><option value="Cash">Cash</option><option value="UPI">UPI</option><option value="Bank Transfer">Bank Transfer</option><option value="Cheque">Cheque</option></select></div>
                            <div class="col-6"><label class="form-label">Reference</label><input type="text" class="form-control" id="advRef" placeholder="Txn ID"></div>
                        </div>
                        <div class="mb-3 mt-2">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="advNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveAdvancePaymentBtn">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Ledger Modal -->
    <div class="modal fade" id="customerLedgerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Customer Ledger: <span id="ledgerCustomerName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="d-flex gap-2">
                            <input type="date" class="form-control form-control-sm" id="ledgerStartDate">
                            <input type="date" class="form-control form-control-sm" id="ledgerEndDate">
                            <button class="btn btn-sm btn-outline-primary" id="filterLedgerBtn">Filter</button>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="window.printLedger()">
                                <i class="fas fa-print me-1"></i> Print Statement
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered table-hover" id="ledgerTable">
                            <thead class="table-light">
                                <tr><th>Date</th><th>Description</th><th>Ref / Inv #</th><th class="text-end">Debit (Inv)</th><th class="text-end">Credit (Pay)</th><th class="text-end">Balance</th></tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot class="table-light fw-bold">
                                <tr><td colspan="3" class="text-end">Totals:</td><td class="text-end" id="ledgerTotalDebit">&#8377;0</td><td class="text-end" id="ledgerTotalCredit">&#8377;0</td><td class="text-end" id="ledgerFinalBalance">&#8377;0</td></tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock In/Out Modals -->
    <div class="modal fade" id="stockInModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Raw Material Purchase (Stock In)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 class="item-name mb-3"></h6>
                    <div class="row g-2">
                        <div class="col-md-6">
                            <label class="form-label">Purchase Date</label>
                            <input type="date" class="form-control" id="stockInDate">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Supplier Name</label>
                            <select class="form-select" id="stockInSupplier"></select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Invoice Number</label>
                            <input type="text" class="form-control" id="stockInInvoice">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Vehicle Number</label>
                            <input type="text" class="form-control" id="stockInVehicleNo">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Material Name</label>
                            <input type="text" class="form-control" id="stockInMaterialName" readonly>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Quantity Received</label>
                            <input type="number" class="form-control" id="stockInQuantity">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Unit</label>
                            <select class="form-select" id="stockInUnit">
                                <option value="Bag">Bag</option>
                                <option value="Ton">Ton</option>
                                <option value="CFT">CFT</option>
                                <option value="Kg">Kg</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Rate per Unit</label>
                            <input type="number" class="form-control" id="stockInCost">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Loading / Transport Charges (&#8377;)</label>
                            <input type="number" class="form-control" id="stockInTransportCost" value="0">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Total Amount (&#8377;)</label>
                            <input type="number" class="form-control" id="stockInTotal" readonly>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Received By</label>
                            <input type="text" class="form-control" id="stockInReceivedBy">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Remarks</label>
                            <input type="text" class="form-control" id="stockInRemarks">
                        </div>
                    </div>
                    <div class="form-text mt-2">Stock increases automatically after saving this purchase.</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="confirmStockInBtn">Save Purchase</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="stockOutModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Stock Out</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6 class="item-name mb-3"></h6>
                    <div class="mb-3">
                        <label class="form-label">Quantity to Remove</label>
                        <input type="number" class="form-control" id="stockOutQuantity">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Reason</label>
                        <input type="text" class="form-control" id="stockOutReason" value="Project Use">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Order (Optional)</label>
                        <input type="text" class="form-control" id="stockOutProject">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Customer (For Delivery Challan)</label>
                        <select class="form-select" id="stockOutCustomer"></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Vehicle (Dispatch)</label>
                        <select class="form-select" id="stockOutVehicle"></select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Driver Name</label>
                        <input type="text" class="form-control" id="stockOutDriver">
                    </div>
                </div><div class="modal-footer">
                    <button type="button" class="btn btn-warning" id="confirmStockOutBtn">Confirm Stock Out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Production Modal -->
    <div class="modal fade" id="productionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Production Run</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productionForm">
                        <div class="modal-section">
                            <div class="modal-section-title">Core Details</div>
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-bold">Product Master</label>
                                    <select class="form-select" id="prodProductMaster">
                                        <option value="">Select Product Master...</option>
                                    </select>
                                    <div class="form-text">Select the product to start production.</div>
                                    <div id="productDetails" class="form-text text-primary fw-bold mt-1"></div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Mold Number</label>
                                    <select class="form-select" id="prodMoldNumber"></select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Production Location (Casting Area)</label>
                                    <select class="form-select" id="prodCastingLocation"></select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-bold">Quantity Made</label>
                                    <input type="number" class="form-control" id="produceQuantity" min="1" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Production Date</label>
                                    <input type="date" class="form-control" id="productionDate">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Supervisor</label>
                                    <input type="text" class="form-control" id="productionSupervisor">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Remarks</label>
                                    <input type="text" class="form-control" id="productionNotes">
                                </div>
                            </div>
                        </div>

                        <div class="accordion mb-3" id="prodAdvanced">
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="prodAdvancedHeading">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#prodAdvancedBody">
                                        Advanced (Optional)
                                    </button>
                                </h2>
                                <div id="prodAdvancedBody" class="accordion-collapse collapse" data-bs-parent="#prodAdvanced">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Labour Cost (&#8377;)</label>
                                                <input type="number" class="form-control" id="labourCost" value="0">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Power Cost (&#8377;)</label>
                                                <input type="number" class="form-control" id="powerCost" value="0">
                                            </div>
                                            <div class="col-12 d-none" id="dailyLabourPlanner">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <label class="form-label fw-bold mb-0">Daily Labour Plan (7 Days)</label>
                                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="regenDailyLabourBtn">
                                                        <i class="fas fa-sync-alt me-1"></i>Regenerate 7 Days
                                                    </button>
                                                </div>
                                                <div class="table-responsive border rounded">
                                                    <table class="table table-sm align-middle mb-0">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th style="min-width: 130px;">Date</th>
                                                                <th style="min-width: 140px;">Qty Produced</th>
                                                                <th style="min-width: 140px;">Rate / Product (&#8377;)</th>
                                                                <th style="min-width: 140px;">Amount (&#8377;)</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="dailyLabourRows"></tbody>
                                                    </table>
                                                </div>
                                                <div class="small text-muted mt-2">
                                                    Labour total is auto-calculated from daily entries and used in production costing.
                                                    <span class="fw-semibold ms-1">Total: <span id="dailyLabourTotal">&#8377;0.00</span></span>
                                                </div>
                                            </div>
                                        </div>
                                        <hr class="my-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="form-label fw-bold mb-0">Raw Materials Used</label>
                                            <span id="stockStatusBadge" class="badge bg-secondary">Status: Pending</span>
                                            <button type="button" class="btn btn-sm btn-outline-primary" id="addIngredientBtn"><i class="fas fa-plus"></i> Add Material</button>
                                        </div>
                                        <div id="ingredientsContainer" class="mb-3 p-2 bg-light rounded">
                                            <!-- Dynamic Rows -->
                                        </div>
                                        <div class="d-flex justify-content-end">
                                             <h6 class="mb-0">Estimated Cost: <span class="text-primary fw-bold" id="estimatedCost">&#8377;0.00</span></h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-between">
                    <div class="text-muted small">Flow: Start â†’ Curing â†’ Ready Stock â†’ (Optional) Septic Allocation</div>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" id="saveProductionBtn">Start Production</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Labour Entry Modal -->
    <div class="modal fade" id="dailyLabourModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Daily Labour</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2 small text-muted">Batch: <span id="dailyLabourRunBatch" class="fw-semibold">-</span></div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="dailyLabourDate">
                        </div>
                        <div class="col-md-6 d-flex align-items-end">
                            <button type="button" class="btn btn-outline-primary w-100" id="addDailyLabourWorkerBtn">
                                <i class="fas fa-user-plus me-1"></i>Add Labour
                            </button>
                        </div>
                        <div class="col-12">
                            <div class="table-responsive border rounded">
                                <table class="table table-sm align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="min-width: 170px;">Labour Name</th>
                                            <th style="min-width: 120px;">Qty</th>
                                            <th style="min-width: 140px;">Rate / Product (&#8377;)</th>
                                            <th style="min-width: 130px;">Amount (&#8377;)</th>
                                            <th style="width: 54px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="dailyLabourWorkerRows"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Total Amount (&#8377;)</label>
                            <input type="number" class="form-control" id="dailyLabourAmount" readonly value="0.00">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Notes (optional)</label>
                            <input type="text" class="form-control" id="dailyLabourNotes" placeholder="Optional note for this day">
                        </div>
                    </div>
                    <div class="form-text mt-2">Daily entry updates total labour cost of this run automatically.</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveDailyLabourBtn">Save Daily Labour</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Labour Ledger View Modal -->
    <div class="modal fade" id="labourLedgerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Labour Payment Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-2 mb-3">
                        <div class="col-md-6 small text-muted">Batch: <span id="labourLedgerBatch" class="fw-semibold">-</span></div>
                        <div class="col-md-6 small text-muted">Product: <span id="labourLedgerProduct" class="fw-semibold">-</span></div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-sm table-hover" id="labourLedgerTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Worker</th>
                                    <th class="text-end">Due</th>
                                    <th class="text-end">Paid</th>
                                    <th class="text-end">Pending</th>
                                    <th>Status</th>
                                    <th>Payment Ref</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-4">
                            <div class="border rounded p-2 bg-light">
                                <div class="small text-muted">Total Amount</div>
                                <div class="fw-bold" id="labourLedgerTotal">₹0.00</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-2 bg-light">
                                <div class="small text-muted">Total Payments</div>
                                <div class="fw-bold text-success" id="labourLedgerPaidTotal">₹0.00</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="border rounded p-2 bg-light">
                                <div class="small text-muted">Pending</div>
                                <div class="fw-bold text-danger" id="labourLedgerPendingTotal">₹0.00</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Master Modal -->
    <div class="modal fade" id="productMasterModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Product Master</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productMasterFormNew">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Product Category</label>
                                <select class="form-select" id="pmCategoryNew">
                                    <option value="RCC Pipe">RCC Pipe</option>
                                    <option value="Septic Tank">Septic Tank</option>
                                    <option value="Water Tank">Water Tank</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="pmNameNew" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Pipe Type</label>
                                <select class="form-select" id="pmPipeTypeNew">
                                    <option value="Plain End">Plain End</option>
                                    <option value="Socket & Spigot">Socket & Spigot</option>
                                    <option value="Tongue and Groove or T/4">Tongue and Groove or T/4</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Load Class</label>
                                <select class="form-select" id="pmLoadClassNew">
                                    <option value="NP2">NP2</option>
                                    <option value="NP3">NP3</option>
                                    <option value="NP4">NP4</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Unit</label>
                                <input type="text" class="form-control" id="pmUnitNew" value="Nos">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Cost Price (&#8377;)</label>
                                <input type="number" class="form-control" id="pmCostPriceNew" step="0.01" value="0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Selling Price (&#8377;)</label>
                                <input type="number" class="form-control" id="pmSellingPriceNew" step="0.01" value="0">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">HSN/SAC</label>
                                <input type="text" class="form-control" id="pmHsnNew" placeholder="Auto" maxlength="10">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">GST %</label>
                                <input type="number" class="form-control" id="pmGstRateNew" step="0.01" value="18">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Standard Production Time (hours)</label>
                                <input type="number" class="form-control" id="pmProdTimeNew" step="0.5">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Standard Curing Days</label>
                                <input type="number" class="form-control" id="pmCuringDaysNew" value="7">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="pmStatusNew">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Product Image</label>
                                <div id="productImageExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="productImageLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View Image</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteProductImage()"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control" id="pmImageFile" accept="image/*">
                                <div class="progress mt-2 d-none" id="pmImageProgressWrap" style="height: 8px;">
                                    <div class="progress-bar" id="pmImageProgress" role="progressbar" style="width: 0%;">0%</div>
                                </div>
                                <div id="pmImageStatus" class="text-muted mt-1" style="font-size: 0.8rem;"></div>
                                <input type="hidden" id="pmImageUrl">
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive mt-3">
                        <table class="table table-sm align-middle" id="productMasterTable">
                            <thead class="table-light">
                                <tr><th>Product</th><th>Image</th><th>Category</th><th>Price Summary</th><th>Status</th><th>Actions</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="pmCreateBtn">Save Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mould Master Modal -->
    <div class="modal fade" id="moldMasterModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mould Master</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="moldMasterForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Mould ID / Number</label>
                                <input type="text" class="form-control" id="mmId" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Mould Type</label>
                                <select class="form-select" id="mmType">
                                    <option value="Pipe Mold">Pipe Mold</option>
                                    <option value="Ring Mold">Ring Mold</option>
                                    <option value="Slab Mold">Slab Mold</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Supported Product</label>
                                <input type="text" class="form-control" id="mmProduct">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Mould Status</label>
                                <select class="form-select" id="mmStatus">
                                    <option value="Available">Available</option>
                                    <option value="In Production">In Production</option>
                                    <option value="Under Maintenance">Under Maintenance</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Last Used Date</label>
                                <input type="date" class="form-control" id="mmLastUsed">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Remarks</label>
                                <input type="text" class="form-control" id="mmRemarks">
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive mt-3">
                        <table class="table table-sm align-middle" id="moldMasterTable">
                            <thead class="table-light">
                                <tr><th>Mould</th><th>Status</th><th>Product</th><th>Actions</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="mmCreateBtn">Save Mould</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Location Master Modal -->
    <div class="modal fade" id="locationMasterModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Location Master</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="locationMasterForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Location Name</label>
                                <input type="text" class="form-control" id="lmName" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Location Type</label>
                                <select class="form-select" id="lmType">
                                    <option value="Production Output">Production Output</option>
                                    <option value="Curing House">Curing House</option>
                                    <option value="Ready Stock Yard">Ready Stock Yard</option>
                                    <option value="Septic Tank Area">Septic Tank Area</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Capacity (optional)</label>
                                <input type="number" class="form-control" id="lmCapacity">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="lmStatus">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive mt-3">
                        <table class="table table-sm align-middle" id="locationMasterTable">
                            <thead class="table-light">
                                <tr><th>Location</th><th>Type</th><th>Status</th><th>Actions</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="lmCreateBtn">Save Location</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Move To Curing Modal -->
    <div class="modal fade" id="moveToCuringModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Move To Curing</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="moveToCuringForm">
                        <div class="modal-section">
                            <div class="modal-section-title">Curing Transfer</div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Batch Number</label>
                                    <input type="text" class="form-control" id="curingBatchId" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="curingQuantity" min="1">
                                    <div class="form-text" id="curingQtyHint">Move quantity to curing house.</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">From Location (Casting Area)</label>
                                    <input type="text" class="form-control" id="curingFromLocation" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">To Location (Curing House)</label>
                                    <select class="form-select" id="curingToLocation">
                                        <option value="">Select Location...</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Curing Start Date</label>
                                    <input type="date" class="form-control" id="curingStartDate">
                                </div>
                                <div class="col-12">
                                    <div class="small text-muted">
                                        Produced: <span id="curingProducedQty" class="fw-semibold">0</span> |
                                        Already On Curing: <span id="curingMovedQty" class="fw-semibold">0</span> |
                                        Waiting For Curing: <span id="curingWaitingQty" class="fw-semibold text-warning">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveMoveToCuringBtn">Move To Curing</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Curing Completed Modal -->
    <div class="modal fade" id="curingCompleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Curing Completed</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="curingCompleteForm">
                        <div class="modal-section">
                            <div class="modal-section-title">Completion Details</div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Batch Number</label>
                                    <input type="text" class="form-control" id="completeBatchId" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Completion Date</label>
                                    <input type="date" class="form-control" id="completeDate">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Passed Quantity</label>
                                    <input type="number" class="form-control" id="completePassedQty" min="0">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Damaged Quantity</label>
                                    <input type="number" class="form-control" id="completeDamagedQty" min="0" value="0">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Move To Location (Ready Stock Yard)</label>
                                    <select class="form-select" id="completeReadyLocation">
                                        <option value="">Select Location...</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="saveCuringCompleteBtn">Complete Curing</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Septic Allocation Modal -->
    <div class="modal fade" id="septicAllocationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Septic Allocation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="septicAllocationForm">
                        <div class="modal-section">
                            <div class="modal-section-title">Allocation Details</div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Quantity Allocated</label>
                                    <input type="number" class="form-control" id="septicAllocationQty" min="0" value="0">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Septic Location</label>
                                    <select class="form-select" id="septicAllocationLocation">
                                        <option value="">Select Location...</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Septic Product (Assembly)</label>
                                    <select class="form-select" id="septicAllocationProduct">
                                        <option value="">Select Septic Product...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-text mt-2">Available only after curing completion.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSepticAllocationBtn">Save Allocation</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profit Report Modal -->
    <div class="modal fade" id="profitReportModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Profit Engine Analysis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card bg-success text-white">
                                <div class="card-body">
                                    <h6>Total Net Profit (All Time)</h6>
                                    <h3 id="prTotalProfit">&#8377;0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-info text-white">
                                <div class="card-body">
                                    <h6>Avg Profit Margin</h6>
                                    <h3 id="prAvgMargin">0%</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-warning text-dark">
                                <div class="card-body">
                                    <h6>Outstanding Collections</h6>
                                    <h3 id="prOutstanding">&#8377;0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <ul class="nav nav-tabs mb-3" id="profitTabs">
                        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#prByProduct">By Product/Size</a></li>
                        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#prByTime">By Month</a></li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="prByProduct">
                            <div class="table-responsive">
                                <table class="table table-hover" id="prProductTable">
                                    <thead><tr><th>Product</th><th>Qty Sold</th><th>Avg Cost</th><th>Avg Price</th><th>Total Profit</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="prByTime">
                            <div class="table-responsive">
                                <table class="table table-hover" id="prTimeTable">
                                    <thead><tr><th>Month</th><th>Revenue</th><th>Cost</th><th>Net Profit</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Modal -->
    <div class="modal fade" id="vehicleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="vehicleForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Vehicle Number (Reg. No)</label>
                                <input type="text" class="form-control" id="vehicleName" placeholder="e.g. KA-01-AB-1234" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Model / Make</label>
                                <input type="text" class="form-control" id="vehicleModel" placeholder="e.g. Tata Ace Gold">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Type</label>
                                <select class="form-select" id="vehicleType">
                                    <option value="Truck">Truck / Lorry</option>
                                    <option value="Trolley">Tractor Trolley</option>
                                    <option value="JCB">JCB / Excavator</option>
                                    <option value="Mixer">Concrete Mixer</option>
                                    <option value="Car">Car / SUV</option>
                                    <option value="Bike">Bike / Scooter</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Owner Name</label>
                                <input type="text" class="form-control" id="vehicleOwner">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Owner Phone</label>
                                <input type="tel" class="form-control" id="vehicleOwnerPhone" placeholder="Mobile Number">
                            </div>
                            
                            <div class="col-12"><hr class="my-1"></div>
                            
                            <div class="col-md-6">
                                <label class="form-label">RC / Chassis No</label>
                                <input type="text" class="form-control" id="vehicleChassis">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Engine No</label>
                                <input type="text" class="form-control" id="vehicleEngine">
                            </div>
                            
                            <div class="col-12"><hr class="my-1"></div>
                            
                            <div class="col-md-6">
                                <label class="form-label">Fastag ID / Bank</label>
                                <input type="text" class="form-control" id="vehicleFastagId">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Current Fastag Balance (&#8377;)</label>
                                <input type="number" class="form-control" id="vehicleFastagBalance" value="0">
                            </div>

                            <div class="col-12"><hr class="my-1"></div>
                            <h6 class="text-primary mb-2">Document Expiry Dates</h6>

                            <div class="col-md-6">
                                <label class="form-label">Insurance Expiry</label>
                                <input type="date" class="form-control" id="insuranceExpiry">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Permit / Tax Expiry</label>
                                <input type="date" class="form-control" id="permitExpiry">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fitness Cert. Expiry</label>
                                <input type="date" class="form-control" id="fitnessExpiry">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">PUC (Pollution) Expiry</label>
                                <input type="date" class="form-control" id="pucExpiry">
                            </div>

                            <div class="col-12"><hr class="my-1"></div>
                            <div class="col-12 d-flex justify-content-between align-items-center">
                                <h6 class="text-primary mb-2">Document Photos</h6>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="compressImages" checked>
                                    <label class="form-check-label small" for="compressImages">Compress to 50KB</label>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label small">RC Copy</label>
                                <div id="rcExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="rcLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View RC</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('rc')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="rcFile" accept="image/*" onchange="window.handleFileSelect('rc')">
                                <div id="rcStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="rcUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Insurance Copy</label>
                                <div id="insuranceExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="insuranceLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View Ins.</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('insurance')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="insuranceFile" accept="image/*" onchange="window.handleFileSelect('insurance')">
                                <div id="insuranceStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="insuranceUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Permit Copy</label>
                                <div id="permitExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="permitLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View Permit</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('permit')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="permitFile" accept="image/*" onchange="window.handleFileSelect('permit')">
                                <div id="permitStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="permitUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Fitness Copy</label>
                                <div id="fitnessExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="fitnessLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View Fit.</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('fitness')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="fitnessFile" accept="image/*" onchange="window.handleFileSelect('fitness')">
                                <div id="fitnessStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="fitnessUrl">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">PUC Copy</label>
                                <div id="pucExisting" class="d-none mb-1 d-flex align-items-center justify-content-between border rounded p-1 bg-light">
                                    <a href="#" target="_blank" id="pucLink" class="text-decoration-none small text-truncate text-primary fw-bold" style="max-width: 80%;"><i class="fas fa-file-image me-1"></i>View PUC</a>
                                    <button type="button" class="btn btn-sm btn-link text-danger p-0" onclick="window.deleteDoc('puc')"><i class="fas fa-trash-alt"></i></button>
                                </div>
                                <input type="file" class="form-control form-control-sm" id="pucFile" accept="image/*" onchange="window.handleFileSelect('puc')">
                                <div id="pucStatus" class="text-muted mt-1" style="font-size: 0.7rem;"></div>
                                <input type="hidden" id="pucUrl">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveVehicleBtn">Save Vehicle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Expense Modal -->
    <div class="modal fade" id="vehicleExpenseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Vehicle Expense</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="vehicleExpenseForm">
                        <div class="mb-3">
                            <label class="form-label">Vehicle</label>
                            <select class="form-select" id="expenseVehicleSelect" required></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Expense Type</label>
                            <select class="form-select" id="expenseType">
                                <option value="Fuel">Fuel (Diesel/Petrol)</option>
                                <option value="Maintenance">Maintenance/Repair</option>
                                <option value="Insurance">Insurance Renewal</option>
                                <option value="Documents">Permits/Docs</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Amount (&#8377;)</label>
                            <input type="number" class="form-control" id="expenseAmount" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Current Odometer (km/hrs)</label>
                            <input type="number" class="form-control" id="expenseOdometer">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="expenseDescription" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveExpenseBtn">Save Expense</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div class="modal fade" id="supplierModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supplierForm">
                        <div class="mb-3">
                            <label class="form-label">Supplier Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="supplierName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Contact Person Name</label>
                            <input type="text" class="form-control" id="supplierContact">
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Mobile Number</label>
                                <input type="tel" class="form-control" id="supplierPhone">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Alternate Mobile</label>
                                <input type="tel" class="form-control" id="supplierAltPhone">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="supplierAddress" rows="2"></textarea>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-md-4">
                                <label class="form-label">Pincode</label>
                                <input type="text" class="form-control" id="supplierPincode">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Village</label>
                                <select class="form-select" id="supplierVillage">
                                    <option value="">Select Village</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">District</label>
                                <select class="form-select" id="supplierDistrict">
                                    <option value="">Select District</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Mandal</label>
                                <select class="form-select" id="supplierMandal">
                                    <option value="">Select Mandal</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">State</label>
                                <select class="form-select" id="supplierState">
                                    <option value="">Select State</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">GST Number (optional)</label>
                            <input type="text" class="form-control" id="supplierGstin">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Material Types Supplied</label>
                            <select class="form-select" id="supplierMaterials" multiple>
                                <option value="Cement">Cement</option>
                                <option value="Sand">Sand</option>
                                <option value="Dust">Dust</option>
                                <option value="Aggregate">Aggregate</option>
                                <option value="Steel">Steel</option>
                            </select>
                            <div class="form-text">Hold Ctrl/Cmd to select multiple.</div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Payment Terms</label>
                                <select class="form-select" id="supplierPaymentTerms">
                                    <option value="Cash">Cash</option>
                                    <option value="Credit">Credit</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Credit Days</label>
                                <input type="number" class="form-control" id="supplierCreditDays" value="0">
                            </div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="supplierStatus">
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Notes</label>
                                <input type="text" class="form-control" id="supplierNotes">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveSupplierBtn">Save Supplier</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Payment Modal -->
    <div class="modal fade" id="supplierPaymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Record Payment to Supplier</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supplierPaymentForm">
                        <input type="hidden" id="spId">
                        <input type="hidden" id="spName">
                        <input type="hidden" id="spLabourPayableId">
                        <div class="mb-3">
                            <label class="form-label">Supplier</label>
                            <input type="text" class="form-control" id="spNameDisplay" readonly>
                        </div>
                        <div class="alert alert-warning py-2 px-3 d-none" id="spLabourDueInfo"></div>
                        <div class="row g-2">
                            <div class="col-6"><label class="form-label">Date</label><input type="date" class="form-control" id="spDate" required></div>
                            <div class="col-6"><label class="form-label">Amount (&#8377;)</label><input type="number" class="form-control" id="spAmount" required min="1"></div>
                            <div class="col-6"><label class="form-label">Mode</label><select class="form-select" id="spMode"><option value="Cash">Cash</option><option value="UPI">UPI</option><option value="Bank Transfer">Bank Transfer</option><option value="Cheque">Cheque</option></select></div>
                            <div class="col-6"><label class="form-label">Reference</label><input type="text" class="form-control" id="spRef" placeholder="Txn ID"></div>
                        </div>
                        <div class="mb-3 mt-2">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="spNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveSupplierPaymentBtn">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Ledger Modal -->
    <div class="modal fade" id="supplierLedgerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Supplier Ledger: <span id="slName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="d-flex gap-2">
                            <input type="date" class="form-control form-control-sm" id="slStartDate">
                            <input type="date" class="form-control form-control-sm" id="slEndDate">
                            <button class="btn btn-sm btn-outline-primary" id="filterSupplierLedgerBtn">Filter</button>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="window.printSupplierLedger()">
                                <i class="fas fa-print me-1"></i> Print
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered table-hover" id="supplierLedgerTable">
                            <thead class="table-light">
                                <tr><th>Date</th><th>Description</th><th>Ref</th><th class="text-end">Purchase (Cr)</th><th class="text-end">Payment (Dr)</th><th class="text-end">Balance</th></tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot class="table-light fw-bold">
                                <tr><td colspan="3" class="text-end">Totals:</td><td class="text-end" id="slTotalPurchase">&#8377;0</td><td class="text-end" id="slTotalPayment">&#8377;0</td><td class="text-end" id="slFinalBalance">&#8377;0</td></tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier History Modal -->
    <div class="modal fade" id="supplierHistoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Purchase History: <span id="historySupplierName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-sm" id="supplierHistoryTable">
                        <thead>
                            <tr><th>Date</th><th>Item</th><th>Qty</th><th>Cost</th><th>Invoice</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff Modal -->
    <div class="modal fade" id="staffModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Staff Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="staffForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="staffName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mobile Number</label>
                            <input type="tel" class="form-control" id="staffMobile" placeholder="10 digit number" required>
                            <div class="form-text">This will be used for attendance login.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="staffRole">
                                <option value="Labour">Labour</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Driver">Driver</option>
                                <option value="Manager">Manager</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Payment Type</label>
                            <select class="form-select" id="staffSalaryType">
                                <option value="Daily">Daily Wage</option>
                                <option value="Monthly">Monthly Salary</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Amount (&#8377;)</label>
                            <input type="number" class="form-control" id="staffWage" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveStaffBtn">Save Staff</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Salary Payment Modal -->
    <div class="modal fade" id="salaryPaymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Salary Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="salaryPaymentForm">
                        <div class="mb-3">
                            <label class="form-label">Staff Member</label>
                            <select class="form-select" id="salaryStaffSelect" required></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Salary Month</label>
                            <input type="month" class="form-control" id="salaryMonth" required>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">Payable Amount (&#8377;)</label>
                                <input type="number" class="form-control" id="salaryPayable" readonly>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Payment Amount (&#8377;)</label>
                                <input type="number" class="form-control" id="salaryAmount" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Payment Date</label>
                            <input type="date" class="form-control" id="salaryDate" required>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">Mode</label>
                                <select class="form-select" id="salaryMode">
                                    <option value="Cash">Cash</option>
                                    <option value="Bank Transfer">Bank Transfer</option>
                                    <option value="UPI">UPI</option>
                                    <option value="Cheque">Cheque</option>
                                </select>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Reference</label>
                                <input type="text" class="form-control" id="salaryReference" placeholder="UTR / Cheque no">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="salaryNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveSalaryPaymentBtn">Save Payment</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Settings & QR Modal -->
    <div class="modal fade" id="attendanceSettingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Attendance Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="attendanceSettingsForm">
                        <div class="mb-3">
                            <label class="form-label">Allowed Check-in Start Time</label>
                            <input type="time" class="form-control" id="attStartTime">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Allowed Check-in End Time</label>
                            <input type="time" class="form-control" id="attEndTime">
                        </div>
                        <div class="mb-3">
                            <div class="form-text">Attendance marking is based on mobile number scan/entry only.</div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </div>
                    </form>
                    <hr>
                    <div class="text-center mt-4">
                        <h6>Attendance QR Code</h6>
                        <p class="small text-muted">Print this and stick it on your door.</p>
                        <div id="qrcode" class="d-flex justify-content-center my-3"></div>
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.printQR()">
                            <i class="fas fa-print me-1"></i> Print QR
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Attendance Modal -->
    <div class="modal fade" id="manualAttendanceModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manual Attendance Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="manualAttendanceForm">
                        <div class="mb-3">
                            <label class="form-label">Staff Member</label>
                            <select class="form-select" id="manualStaffSelect" required></select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="manualDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Time</label>
                            <input type="time" class="form-control" id="manualTime" value="09:00">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="manualStatus">
                                <option value="Present">Full Day</option>
                                <option value="Half-Day">Half Day</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Wage for Day (&#8377;)</label>
                            <input type="number" class="form-control" id="manualWage" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveManualAttendanceBtn">Save Record</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Member Modal -->
    <div class="modal fade" id="teamMemberModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Team Member Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="teamMemberForm">
                        <input type="hidden" id="tmId">
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="tmEmail" required>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control" id="tmFirstName" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="tmLastName" required>
                            </div>
                        </div>
                        <div class="mb-3" id="tmPasswordContainer">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="tmPassword" minlength="6">
                            <div class="form-text">Required for new members.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="tmRole">
                                <option value="manager">Manager</option>
                                <option value="staff">Staff</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label d-block">Permissions</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="permDelete">
                                <label class="form-check-label" for="permDelete">Can Delete Items</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="permRevenue">
                                <label class="form-check-label" for="permRevenue">View Revenue</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveTeamMemberBtn">Save Member</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generic Confirmation Modal -->
    <div class="modal fade" id="genericConfirmModal" tabindex="-1" style="z-index: 1060;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="genericConfirmTitle">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="genericConfirmMessage">Are you sure?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="genericConfirmBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generic Input Modal -->
    <div class="modal fade" id="genericInputModal" tabindex="-1" style="z-index: 1060;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="genericInputTitle">Enter Value</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label id="genericInputLabel" class="form-label"></label>
                    <input type="text" class="form-control" id="genericInputValue">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="genericInputBtn">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Backup Modal -->
    <div class="modal fade" id="restoreBackupModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Restore Backup</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-danger small mb-3">Restoring will overwrite existing data. This action cannot be undone.</p>
                    <div class="table-responsive">
                        <table class="table table-hover" id="restoreBackupTable">
                            <thead>
                                <tr>
                                    <th>File</th>
                                    <th>Size</th>
                                    <th>Created</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="4" class="text-center text-muted">Loading backups...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="small text-muted" id="restoreStatus"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="googlePasswordSetupModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-shield-alt me-2 text-warning"></i>Set Account Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning py-2 mb-3">
                        You signed in with Google. Set a password now. Google Sign-In will be disabled after this step.
                    </div>
                    <form id="googlePasswordSetupForm">
                        <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <input type="password" class="form-control" id="googleSetupNewPassword" minlength="6" autocomplete="new-password" required>
                        </div>
                        <div class="mb-1">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="googleSetupConfirmPassword" minlength="6" autocomplete="new-password" required>
                        </div>
                        <div class="small text-muted" id="googlePasswordSetupStatus"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Later</button>
                    <button type="button" class="btn btn-warning" id="confirmGooglePasswordSetupBtn">
                        <i class="fas fa-key me-2"></i>Set Password & Disable Google
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div class="modal fade" id="imagePreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Document Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center bg-light">
                    <img id="previewImage" src="" class="img-fluid border rounded shadow-sm" style="max-height: 70vh;" alt="Preview">
                    <div class="mt-2 text-muted small" id="previewInfo"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Expiry Report Modal -->
    <div class="modal fade" id="expiryReportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Document Expiry Report (Next 30 Days)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle" id="expiryReportTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Vehicle</th>
                                    <th>Document</th>
                                    <th>Expiry Date</th>
                                    <th>Status</th>
                                    <th>Renewed?</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-primary" id="emailExpiryReportBtn">
                    <i class="fas fa-paper-plane me-1"></i>Email Report
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
    </div>

    <!-- Premium Loader -->
    <div id="premiumLoader" class="premium-loader d-flex">
        <div class="loader-content">
            <div class="loader-box">
                <div class="spinner-ring ring-outer"></div>
                <div class="spinner-ring ring-inner"></div>
                <img src="logo.png" class="center-icon" alt="Logo" style="width: 50px; height: 50px; object-fit: contain;">
            </div>
            <h5 class="mt-3 fw-bold text-dark">SSPC</h5>
            <p class="text-muted small">Loading Business Data...</p>
        </div>
    </div>

    <style>
    .premium-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(8px);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }
    .loader-content {
        text-align: center;
        background: transparent;
        box-shadow: none;
        border: none;
        min-width: 250px;
    }
    .loader-box {
        position: relative;
        width: 80px;
        height: 80px;
        margin: 0 auto;
    }
    .spinner-ring {
        position: absolute;
        border-radius: 50%;
        border: 4px solid transparent;
    }
    .ring-outer {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-top-color: #0d6efd;
        border-bottom-color: #0d6efd;
        animation: spin 2s linear infinite;
    }
    .ring-inner {
        top: 15%;
        left: 15%;
        width: 70%;
        height: 70%;
        border-left-color: #0dcaf0;
        border-right-color: #0dcaf0;
        animation: spin-reverse 1.5s linear infinite;
    }
    .center-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes spin-reverse { 100% { transform: rotate(-360deg); } }

    .inventory-thumb-link {
        display: inline-flex;
        width: 44px;
        height: 44px;
        align-items: center;
        justify-content: center;
    }
    .inventory-thumb {
        width: 44px;
        height: 44px;
        border-radius: 8px;
        object-fit: cover;
        border: 1px solid rgba(0, 0, 0, 0.1);
        background: #f8f9fa;
    }
    .inventory-icon {
        width: 44px;
        height: 44px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #f1f3f5;
        color: #6c757d;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Hero Logo Animation */
    .hero-logo-box {
        position: relative;
        width: 80px;
        height: 80px;
        margin-left: 15px;
    }
    .hero-spinner-ring {
        position: absolute;
        border-radius: 50%;
        border: 3px solid transparent;
    }
    .hero-ring-outer {
        top: 0; left: 0; width: 100%; height: 100%;
        border-top-color: rgba(255,255,255,0.9);
        border-bottom-color: rgba(255,255,255,0.9);
        animation: spin 3s linear infinite;
    }
    .hero-ring-inner {
        top: 15%; left: 15%; width: 70%; height: 70%;
        border-left-color: rgba(255,255,255,0.6);
        border-right-color: rgba(255,255,255,0.6);
        animation: spin-reverse 2s linear infinite;
    }
    .hero-center-icon {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 40px; height: 40px;
        background: white;
        border-radius: 50%;
        padding: 4px;
    }

    .section-actions .btn {
        min-width: 170px;
    }
    .modal-section {
        border: 1px solid rgba(13, 110, 253, 0.08);
        background: #f8fafc;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
    }
    .modal-section-title {
        font-weight: 700;
        font-size: 0.85rem;
        color: #0f172a;
        letter-spacing: 0.02em;
        text-transform: uppercase;
        margin-bottom: 12px;
    }
    .production-status-card {
        border: 1px solid rgba(15, 23, 42, 0.08);
        border-radius: 14px;
        padding: 16px;
        background: #ffffff;
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
    }
    .status-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(0, 1fr));
        gap: 12px;
    }
    .status-item {
        padding: 12px;
        border-radius: 12px;
        background: #f8fafc;
        border: 1px solid rgba(15, 23, 42, 0.06);
    }
    .status-highlight {
        background: rgba(13, 110, 253, 0.08);
        border-color: rgba(13, 110, 253, 0.2);
    }
    .status-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: #64748b;
        margin-bottom: 4px;
    }
    .status-value {
        font-size: 1.3rem;
        font-weight: 700;
        color: #0f172a;
    }
    .production-table thead th {
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: #64748b;
        border-bottom: 1px solid rgba(15, 23, 42, 0.08);
        background: #f8fafc;
    }
    .production-table tbody td {
        vertical-align: middle;
        padding-top: 0.7rem;
        padding-bottom: 0.7rem;
    }
    .production-table tbody tr:hover {
        background: rgba(15, 118, 110, 0.06);
    }
    .production-table .badge {
        font-weight: 600;
        letter-spacing: 0.02em;
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
    }
    .production-table .production-action-cell {
        min-width: 185px;
        width: 220px;
    }
    .production-table td.production-action-cell {
        white-space: normal;
    }
    .production-table .production-action-cell .btn {
        border-radius: 8px;
        white-space: normal;
        line-height: 1.2;
    }
    .production-table .production-primary-actions .btn,
    .production-table .production-secondary-actions .btn {
        width: 100%;
    }
    .production-table .production-inline-actions {
        flex-wrap: wrap;
    }
    .production-table .production-inline-actions .btn {
        min-width: 0;
    }
    .production-table .production-inline-actions .btn.btn-outline-danger {
        width: auto;
        min-width: 38px;
        flex: 0 0 auto;
    }
    .production-table .small div + div {
        margin-top: 2px;
    }
    .production-table .production-workflow-row td {
        padding-top: 0.15rem;
        padding-bottom: 0.85rem;
        border-top: 0;
        background: linear-gradient(180deg, #fbfdff 0%, #f8fafc 100%);
    }
    .production-table .run-workflow-wrap {
        border: 1px solid rgba(15, 23, 42, 0.08);
        border-radius: 12px;
        background: #ffffff;
        padding: 0.65rem 0.8rem;
        display: grid;
        gap: 0.5rem;
        box-shadow: 0 4px 16px rgba(15, 23, 42, 0.04);
    }
    .production-table .run-workflow-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
    }
    .production-table .run-workflow-title {
        font-size: 0.74rem;
        text-transform: uppercase;
        letter-spacing: 0.04em;
        color: #64748b;
        font-weight: 700;
    }
    .production-table .run-workflow-percent {
        font-size: 0.78rem;
        font-weight: 700;
        color: #0f766e;
    }
    .production-table .run-workflow-track {
        height: 8px;
        border-radius: 999px;
        overflow: hidden;
        background: #e2e8f0;
        position: relative;
    }
    .production-table .run-workflow-fill {
        display: block;
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, #0f766e 0%, #0284c7 100%);
        position: relative;
        animation: workflowPulse 1.8s ease-in-out infinite;
    }
    .production-table .run-workflow-fill::after {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        width: 28px;
        right: -16px;
        background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.45), rgba(255,255,255,0));
        animation: workflowSweep 2.2s linear infinite;
    }
    .production-table .run-workflow-steps {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 0.4rem;
    }
    .production-table .workflow-step {
        border: 1px solid rgba(148, 163, 184, 0.32);
        border-radius: 10px;
        padding: 0.45rem 0.5rem;
        background: #f8fafc;
    }
    .production-table .workflow-step.is-current {
        border-color: rgba(14, 165, 233, 0.45);
        background: rgba(14, 165, 233, 0.1);
    }
    .production-table .workflow-step.is-done {
        border-color: rgba(16, 185, 129, 0.45);
        background: rgba(16, 185, 129, 0.1);
    }
    .production-table .workflow-step-label {
        font-size: 0.72rem;
        font-weight: 700;
        color: #0f172a;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        margin-bottom: 2px;
    }
    .production-table .workflow-step-meta {
        font-size: 0.72rem;
        color: #475569;
    }
    .production-table .run-status-timeline {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
    }
    .production-table .timeline-chip {
        font-size: 0.72rem;
        border-radius: 999px;
        padding: 0.2rem 0.55rem;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: #f8fafc;
        color: #475569;
    }
    .production-table .timeline-chip.is-done {
        border-color: rgba(34, 197, 94, 0.4);
        background: rgba(34, 197, 94, 0.1);
        color: #166534;
    }
    .production-table .timeline-chip.is-pending {
        opacity: 0.85;
    }
    .theme-dark .production-table .production-workflow-row td {
        background: linear-gradient(180deg, rgba(15, 23, 42, 0.5) 0%, rgba(30, 41, 59, 0.45) 100%);
    }
    .theme-dark .production-table .run-workflow-wrap {
        background: #0f172a;
        border-color: rgba(148, 163, 184, 0.2);
    }
    .theme-dark .production-table .run-workflow-title {
        color: #94a3b8;
    }
    .theme-dark .production-table .run-workflow-track {
        background: #334155;
    }
    .theme-dark .production-table .workflow-step {
        background: rgba(30, 41, 59, 0.8);
        border-color: rgba(148, 163, 184, 0.2);
    }
    .theme-dark .production-table .workflow-step-label {
        color: #e2e8f0;
    }
    .theme-dark .production-table .workflow-step-meta {
        color: #cbd5e1;
    }
    .theme-dark .production-table .timeline-chip {
        background: rgba(30, 41, 59, 0.85);
        border-color: rgba(148, 163, 184, 0.25);
        color: #cbd5e1;
    }
    .theme-dark .production-table .timeline-chip.is-done {
        color: #86efac;
        border-color: rgba(34, 197, 94, 0.45);
        background: rgba(22, 101, 52, 0.25);
    }
    @keyframes workflowPulse {
        0% { filter: brightness(0.95); }
        50% { filter: brightness(1.1); }
        100% { filter: brightness(0.95); }
    }
    @keyframes workflowSweep {
        0% { transform: translateX(-120px); }
        100% { transform: translateX(320px); }
    }
    #section-production .section-header {
        margin-bottom: 1.25rem;
    }
    #section-production .section-actions .btn {
        border-radius: 10px;
        padding: 0.55rem 1rem;
        font-weight: 600;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
    }
    #section-production .section-actions .btn-outline-secondary {
        box-shadow: none;
    }
    #productionModal .modal-header,
    #moveToCuringModal .modal-header,
    #curingCompleteModal .modal-header,
    #septicAllocationModal .modal-header,
    #dailyLabourModal .modal-header,
    #labourLedgerModal .modal-header {
        background: linear-gradient(120deg, rgba(2, 132, 199, 0.08), rgba(15, 118, 110, 0.08));
        border-bottom: 1px solid rgba(15, 23, 42, 0.08);
    }
    #productionModal .modal-title,
    #moveToCuringModal .modal-title,
    #curingCompleteModal .modal-title,
    #septicAllocationModal .modal-title,
    #dailyLabourModal .modal-title,
    #labourLedgerModal .modal-title {
        font-weight: 700;
        color: #0f172a;
    }
    #productionModal .modal-body,
    #moveToCuringModal .modal-body,
    #curingCompleteModal .modal-body,
    #septicAllocationModal .modal-body,
    #dailyLabourModal .modal-body,
    #labourLedgerModal .modal-body {
        padding: 1.25rem;
    }
    #productionModal .form-control,
    #productionModal .form-select,
    #moveToCuringModal .form-control,
    #moveToCuringModal .form-select,
    #curingCompleteModal .form-control,
    #curingCompleteModal .form-select,
    #septicAllocationModal .form-control,
    #septicAllocationModal .form-select,
    #dailyLabourModal .form-control,
    #dailyLabourModal .form-select,
    #labourLedgerModal .form-control,
    #labourLedgerModal .form-select {
        min-height: 42px;
        border-radius: 10px;
    }
    #productionModal .modal-footer,
    #moveToCuringModal .modal-footer,
    #curingCompleteModal .modal-footer,
    #septicAllocationModal .modal-footer,
    #dailyLabourModal .modal-footer,
    #labourLedgerModal .modal-footer {
        border-top: 1px solid rgba(15, 23, 42, 0.08);
        padding: 0.9rem 1.25rem;
    }
    .production-status-card .btn {
        border-radius: 999px;
        padding: 0.35rem 0.9rem;
        font-weight: 600;
    }

    /* Pulse Animation */
    @keyframes pulse-red {
        0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
        100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }
    .pulse-animation {
        animation: pulse-red 2s infinite;
    }

    /* Mobile Dashboard Enhancements */
    @media (max-width: 991.98px) {
        /* Combined Header & Hero */
        body.section-dashboard .navbar {
            background: linear-gradient(135deg, #0f766e 0%, #0284c7 100%) !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1030;
            box-shadow: none !important;
        }
        
        /* Standard Navbar for other sections */
        body:not(.section-dashboard) .navbar {
            background: linear-gradient(135deg, #0f766e 0%, #0284c7 100%) !important;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
        }

        /* Fix spacing for non-dashboard sections on mobile */
        body:not(.section-dashboard) main {
            padding-top: 0 !important;
            margin-top: 0 !important;
        }

        .navbar-brand, .navbar-brand span, .navbar-toggler {
            color: white !important;
        }
        .navbar-toggler {
            border-color: rgba(255,255,255,0.5) !important;
        }
        .navbar-toggler i {
            color: white !important;
        }
        #notificationBtn {
            background: rgba(255,255,255,0.2) !important;
            border: none !important;
            color: white !important;
        }
        #notificationBtn i {
            color: white !important;
        }
        
        #sidebarToggle i {
            color: white !important;
        }

        .section-actions .btn {
            min-width: auto;
        }
        .status-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        #section-production .section-header {
            gap: 0.75rem;
        }
        #section-production .section-actions {
            width: 100%;
            justify-content: flex-start;
        }
        #section-production .section-actions .btn {
            width: 100%;
        }
        .production-table thead th,
        .production-table tbody td {
            padding: 0.55rem 0.6rem;
            font-size: 0.82rem;
        }
        .production-table .production-action-cell {
            min-width: 200px;
            width: 200px;
        }
        .production-table .run-workflow-steps {
            grid-template-columns: 1fr;
        }
        .production-table .run-workflow-wrap {
            padding: 0.6rem;
        }
        .production-status-card {
            padding: 12px;
        }

        /* Mobile Hero */
        .mobile-hero-container {
            background: linear-gradient(-45deg, #0f766e, #0284c7, #22d3ee, #0f766e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            padding: 90px 20px 50px;
            border-radius: 0 0 30px 30px;
            margin: -1.5rem -1rem 20px -1rem; /* Full width and top alignment */
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.3);
        }

        /* Premium Effects */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .mobile-hero-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-25deg);
            animation: shine 8s infinite;
        }
        @keyframes shine {
            0% { left: -100%; }
            20% { left: 200%; }
            100% { left: 200%; }
        }

        .mobile-hero-bg-icon {
            position: absolute;
            right: -20px;
            top: 10%;
            font-size: 12rem;
            opacity: 0.1;
            color: white;
            transform: rotate(-15deg);
        }

        /* Nav Grid */
        .nav-icon-box {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 12px 5px;
            text-align: center;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: transform 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .nav-icon-box:active {
            transform: scale(0.95);
        }
        .nav-icon-circle {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }
        .nav-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #4a5568;
            line-height: 1.1;
        }

        /* Compact Stats */
        .stat-card-mobile {
            border: none !important;
            border-radius: 16px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04) !important;
            background: white;
        }
        .stat-card-mobile .card-body {
            padding: 15px;
        }
        .stat-card-mobile .text-xs {
            font-size: 0.65rem;
            margin-bottom: 4px !important;
        }
        .stat-card-mobile .h5 {
            font-size: 1.1rem;
        }
    }
    </style>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jQuery & DataTables -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <!-- jsPDF & AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Firebase SDKs (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-remote-config-compat.js"></script>
    <!-- Firebase -->
    <script type="module" src="js/firebase-config.js"></script>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script type="module" src="js/dashboard.js"></script>
    <script type="module" src="js/inventory.js"></script>
    <script type="module" src="js/raw-materials.js"></script>
    <script type="module" src="js/customers.js"></script>
    <script type="module" src="js/projects.js"></script>
    <script type="module" src="js/invoices.js"></script>
    <script type="module" src="js/gst-billing.js"></script>
    <script type="module" src="js/settings.js"></script>
    <script type="module" src="js/production.js"></script>
    <script type="module" src="js/production-masters.js"></script>
    <script type="module" src="js/profile.js"></script>
    <script type="module" src="js/vehicles.js"></script>
    <script type="module" src="js/suppliers.js"></script>
    <script type="module" src="js/staff.js"></script>
    <script type="module" src="js/profit-loss.js"></script>
    <script type="module" src="js/audit.js"></script>
    <script type="module" src="js/payments.js"></script>

    <!-- Daily Vehicle Alert Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for Firebase to load
            const checkInterval = setInterval(() => {
                if (window.firebase && window.firebase.auth()) {
                    clearInterval(checkInterval);
                    initDailyAlerts();
                }
            }, 500);

            function initDailyAlerts() {
                firebase.auth().onAuthStateChanged(user => {
                    if (user) {
                        checkAndSendAlerts(user);
                        setInterval(() => checkAndSendAlerts(user), 60000); // Check every minute
                    }
                });
            }

            async function checkAndSendAlerts(user) {
                const now = new Date();
                // Run only if it's 10:00 AM or later
                if (now.getHours() < 10) return;

                const todayStr = now.toISOString().split('T')[0];
                const lastSent = localStorage.getItem('SSPC_vehicle_alert_date');

                if (lastSent === todayStr) return;

                const db = firebase.firestore();
                try {
                    const localUser = JSON.parse(localStorage.getItem('user') || '{}');
                    const businessId = localUser.businessId || user.uid;
                    if (!businessId) return;

                    const snapshot = await db
                        .collection('users')
                        .doc(businessId)
                        .collection('vehicles')
                        .get();
                    
                    if (snapshot.empty) {
                        localStorage.setItem('SSPC_vehicle_alert_date', todayStr);
                        return;
                    }

                    let alerts = [];
                    const warningDays = 30;
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const vName = data.vehicleName || data.name || 'Unknown Vehicle';
                        checkDocExpiry(vName, 'Insurance', data.insuranceExpiry, alerts, warningDays);
                        checkDocExpiry(vName, 'Permit', data.permitExpiry, alerts, warningDays);
                        checkDocExpiry(vName, 'Fitness', data.fitnessExpiry, alerts, warningDays);
                        checkDocExpiry(vName, 'PUC', data.pucExpiry, alerts, warningDays);
                    });

                    if (alerts.length > 0) {
                        console.log("Sending daily vehicle alerts...");
                        if (window.emailjs) {
                            const emailParams = {
                                to_email: user.email,
                                to_name: user.displayName || 'User',
                                subject: 'Daily Vehicle Expiry Alerts',
                                message: alerts.join('\n')
                            };
                            
                            const remoteConfig = firebase.remoteConfig();
                            remoteConfig.settings = { minimumFetchIntervalMillis: 3600000 };
                            
                            remoteConfig.fetchAndActivate().then(() => {
                                const SERVICE_ID = remoteConfig.getValue('emailjs_service_id').asString();
                                const TEMPLATE_ID = remoteConfig.getValue('emailjs_template_id').asString();
                                const PUBLIC_KEY = remoteConfig.getValue('emailjs_public_key').asString();
                                
                                if (SERVICE_ID && TEMPLATE_ID && PUBLIC_KEY) {
                                    emailjs.send(SERVICE_ID, TEMPLATE_ID, emailParams, PUBLIC_KEY)
                                        .then(() => {
                                            console.log('Daily alert email sent successfully');
                                            localStorage.setItem('SSPC_vehicle_alert_date', todayStr);
                                        })
                                        .catch((err) => {
                                            console.error('Failed to send daily alert email.', err);
                                        });
                                } else {
                                    console.warn('EmailJS config missing', {
                                        service: !!SERVICE_ID,
                                        template: !!TEMPLATE_ID,
                                        publicKey: !!PUBLIC_KEY
                                    });
                                }
                            }).catch(err => console.error('Error fetching Remote Config:', err));
                        }
                    } else {
                        // No alerts today, mark as checked
                        localStorage.setItem('SSPC_vehicle_alert_date', todayStr);
                    }
                } catch (error) {
                    console.error("Error checking vehicle alerts:", error);
                }
            }

            function checkDocExpiry(vehicle, docType, dateStr, alertsArray, warningDays) {
                if (!dateStr) return;
                const expiryDate = new Date(dateStr);
                const today = new Date();
                today.setHours(0,0,0,0);
                
                const diffTime = expiryDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays <= warningDays) {
                    let status = diffDays < 0 ? `EXPIRED ${Math.abs(diffDays)} days ago` : `Expires in ${diffDays} days`;
                    alertsArray.push(`[${vehicle}] ${docType}: ${status} (${dateStr})`);
                }
            }
        });
    </script>

    <script src="js/input-case.js"></script>
    <script src="js/pwa.js"></script>
</body>
</html>
